<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Stock Take</title>
        <link href="resources/images/sys_icon.ico" rel="shortcut icon" type="image/x-icon" />         <link rel="stylesheet" type="text/css" href="style.css?ln=css"/>
        <script  language="javascript">
            function confirmDelete()
            {
                return confirm('Are you sure you want to delete this current record?');
            }
            function alertSave()
            {
                return alert('Record saved successfully!');
            }
        </script> 
    </h:head>
    <f:metadata>
        <f:viewAction action="#{transBean.initTransType(generalUserSetting.currentTransactionTypeId,generalUserSetting.currentTransactionReasonId)}"/>
        <f:viewAction action="#{stock_take_sessionBean.clearStock_take_session(stock_take_session)}"/>
        <f:viewAction action="#{utilityBean.clearList(stock_take_sessionBean.stock_take_sessionObjectList)}"/>
    </f:metadata>
    <f:event listener="#{navigationBean.checkAccessDenied('128', 'View')}" type="preRenderView" />
    <h:body>
        <ui:include src="Menu.xhtml"/>
        <h:form id="formMain" styleClass="clsMainFrom">

            <h:panelGrid styleClass="clsGridMainHeader" columns="1">
                <h:outputLabel styleClass="clsLabelTop" id="olbldiscountPackageHeader" value="#{langsys['Stock']} #{langsys['Take']}"/>
            </h:panelGrid>

            <h:panelGrid id="pnlgInput" styleClass="clsGridMainInput" columns="6">
                <h:outputLabel  value="#{langsys['From']}"/>
                <p:commandLink value="#{langsys['Session']}" action="#{itemBean.displayUNSPSC()}" oncomplete="PF('sbarSession').show()" update="formMain:pnlgSession"/>
                <h:outputLabel  value="#{langsys['Category']}"/>
                <h:outputLabel  value="#{langsys['Subcategory']}"/>
                <h:outputLabel  value="#{langsys['Item']} #{langsys['Description']}"/>
                <h:outputLabel  value=""/>

                <h:inputText disabled="true" value="#{generalUserSetting.getCurrentStore().getStoreName()}" style="width: 120px;height: 24px;"/>
                <h:selectOneMenu id="menuSession" value="#{stock_take_sessionBean.stock_take_session_id}" style="width: 200px;height: 30px;">
                    <f:selectItem itemLabel="" itemValue="0"/>
                    <f:selectItems value="#{stock_take_sessionBean.getOpenStock_take_sessionList()}" var="ss" itemLabel="#{ss.stock_take_session_id} #{ss.start_time} #{ss.notes}" itemValue="#{ss.stock_take_session_id}"/>
                </h:selectOneMenu>
                <h:selectOneMenu id="menuCategory" value="#{stock_take_sessionBean.category_id}" style="width: 200px;height: 30px;">
                    <f:selectItem itemLabel="" itemValue="0"/>
                    <f:selectItems value="#{categoryBean.categories}" var="c" itemLabel="#{c.categoryName}" itemValue="#{c.categoryId}"/>
                    <f:ajax event="change" render="menuSubCategory"/>
                </h:selectOneMenu>
                <h:selectOneMenu id="menuSubCategory" value="#{stock_take_sessionBean.subcategory_id}" style="width: 200px;height: 30px;">
                    <f:selectItem itemLabel="" itemValue="0"/>
                    <f:selectItems value="#{subCategoryBean.getSubCategoriesByCategoryId(stock_take_sessionBean.category_id)}" var="s" itemLabel="#{s.subCategoryName}" itemValue="#{s.subCategoryId}"/>
                </h:selectOneMenu>
                <p:autoComplete id="autcItem" widgetVar="WautcItem" value="#{itemBean.selectedItem}"  
                                completeMethod="#{itemBean.getItemObjectListActive}" 
                                var="itm" 
                                itemLabel="#{itm.description}" 
                                itemValue="#{itm}" 
                                converter="ItemConverter" style="text-align: left" 
                                forceSelection="true" queryDelay="0" 
                                onkeypress="if (event.keyCode == 13) {
                                            doAddClick();
                                            return false;
                                        }" >
                    <p:column headerText="#{langsys['Item']} #{langsys['Description']}" style="text-align: left" >  
                        #{itm.description} 
                    </p:column>
                    <p:column headerText="#{langsys['Alias']}" style="text-align: left" >  
                        #{itm.alias_name} 
                    </p:column>
                    <p:column headerText="#{langsys['Item']} #{langsys['Code']}" style="text-align: left" >  
                        #{itm.itemCode} 
                    </p:column>
                    <p:column headerText="#{langsys['Retail']} #{langsys['sale']} #{langsys['Price']}" style="text-align: left">  
                        <h:outputText value="#{itm.unitRetailsalePrice}">
                            <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{langsys['Wholesale']} #{langsys['Price']}" style="text-align: left" rendered="#{generalUserSetting.currentTransactionReasonId==2 or generalUserSetting.currentTransactionReasonId==10}">
                        <h:outputText value="#{itm.unitWholesalePrice}">
                            <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{langsys['Special']} #{langsys['Price']}" style="text-align: left" rendered="#{generalUserSetting.currentTransactionReasonId==103}">
                        <h:outputText value="#{itm.unit_special_price}">
                            <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{langsys['Currency']}" style="text-align: left">
                        <h:outputText value="#{itm.currencyCode}">
                        </h:outputText>
                    </p:column>
                    <p:ajax event="itemSelect" listener="#{stock_take_sessionBean.setItem_id(itemBean.selectedItem.itemId)}"/>
                    <p:ajax event="change" listener="#{stock_take_sessionBean.setItem_id(itemBean.selectedItem.itemId)}" rendered="#{itemBean.selectedItem!=null}"/>
                </p:autoComplete>
                <p:commandButton id="cbtnAdd" value="#{langsys['Get']}"  icon="ui-icon-arrowrefresh-1-s">
                    <p:ajax listener="#{transItemBean.addTransItemCallCEC(generalUserSetting.currentStore.storeId,generalUserSetting.currentTransactionTypeId,generalUserSetting.currentTransactionReasonId,generalUserSetting.currentSaleType,trans,statusBean,transItemBean.activeTransItems,transItem,itemBean.selectedItem)}" process="@form" update="pnlList growl1"/>
                </p:commandButton>
            </h:panelGrid>
            <p:growl id="growl1"/>
            <h:panelGrid id="pnlList" columns="1">
                <p:dataTable id="dtblDiscountPackage" value="#{discountPackageBean.discountPackages}" var="d" 
                             styleClass="cls-table" 
                             > 
                    <p:column>
                        <!-- column header -->
                        <f:facet name="header"> #{langsys['Package']} #{langsys['Name']} </f:facet>
                        <!-- row record -->
                        <h:outputLabel style="color: #{d.statusColor};" value="#{d.packageName}"/>
                    </p:column>

                    <p:column>
                        <!-- column header -->
                        <f:facet name="header"> #{langsys['Start']} #{langsys['Date']} </f:facet>
                        <!-- row record -->
                        <h:outputLabel value="#{utilityBean.formatDateTime(d.startDate)}" style="color: #{d.statusColor};"/>
                    </p:column>

                    <p:column>
                        <!-- column header -->
                        <f:facet name="header"> #{langsys['End']} #{langsys['Date']} </f:facet>
                        <!-- row record -->
                        <h:outputLabel value="#{utilityBean.formatDateTime(d.endDate)}" style="color: #{d.statusColor};"/>
                    </p:column>

                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">#{langsys['Action']}</f:facet>
                        <!-- row record -->
                        <p:commandLink value="#{langsys['Edit']}" style="color: #{d.statusColor};">
                            <p:ajax listener="#{discountPackageBean.displayDiscountPackage(d,discountPackage)}" process="dtblDiscountPackage" update="formMain:pnlgInput"/>
                        </p:commandLink>
                        &nbsp;
                        <p:commandLink value="#{langsys['Items']}" style="color: #{d.statusColor};">
                            <p:ajax listener="#{discountPackageBean.displayDiscountPackage(d,discountPackage)}" process="dtblDiscountPackage" update="formMain:pnlgInput"/>
                        </p:commandLink>
                        &nbsp;
                    </p:column>
                </p:dataTable>
            </h:panelGrid>
            <p:sidebar widgetVar="sbarSession" position="bottom" baseZIndex="10000" style="height: 600px;">
                <h:panelGrid id="pnlgSession" columns="1" style="text-align: center;">
                    <h:panelGrid columns="3">
                        <h:outputLabel value="#{langsys['Notes']}:"/>
                        <h:inputText value="#{stocktake_session.notes}" style="height: 24px;"/>
                        <p:commandButton value="Start New Stocktake Session" icon="ui-icon-disk" actionListener="#{stock_take_sessionBean.insertStock_take_sessionCall(stocktake_session)}" update="formMain:tblSession formMain:growl2"/>
                    </h:panelGrid>
                    <p:dataTable id="tblSession" rowIndexVar="rowIndex" tableStyle="width:auto;" var="ss" value="#{stock_take_sessionBean.stock_take_sessionObjectList}" 
                                 >
                        <p:column headerText="##" style="text-align: left;font-size: 14px;">
                            <h:outputText value="#{rowIndex+1} "/>
                        </p:column>
                        <p:column headerText="#{langsys['Notes']}" style="text-align: left;font-size: 14px;">
                            <h:outputText value="#{ss.notes}"/>
                        </p:column>
                        <p:column headerText="#{langsys['Started']}" style="text-align: left;font-size: 14px;">
                            <h:outputText value="#{ss.start_time}"/>
                        </p:column>
                        <p:column headerText="#{langsys['Ended']}" style="text-align: left;font-size: 14px;">
                            <h:outputText value="#{ss.end_time}"/>
                        </p:column>
                        <p:column headerText="#{langsys['Available']}" style="text-align: left;font-size: 14px;">
                            <h:outputText value="#{ss.stock_items_available}"/>
                        </p:column>
                        <p:column headerText="#{langsys['Counted']}" style="text-align: left;font-size: 14px;">
                            <h:outputText value="#{ss.stock_items_available}"/>
                        </p:column>
                        <p:column headerText="#{langsys['Status']}" style="text-align: left;font-size: 14px;">
                            <h:outputText value="Open" rendered="#{ss.is_closed eq 0}"/>
                            <h:outputText value="Closed" rendered="#{ss.is_closed eq 1}"/>
                        </p:column>
                    </p:dataTable>
                </h:panelGrid>
                <p:growl id="growl2"/>
            </p:sidebar>
        </h:form>
    </h:body>
</html>

