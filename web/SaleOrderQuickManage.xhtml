<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <title>Quick Order - Sales</title>
        <link href="resources/images/sys_icon.ico" rel="shortcut icon" type="image/x-icon" />         
        <link rel="stylesheet" type="text/css" href="style.css?ln=css"/>
        <script  language="javascript">
            function confirmDelete()
            {
                return confirm('Are you sure you want to delete this current record?');
            }
            function alertSave()
            {
                return alert('Record saved successfully!');
            }
            function doPrintHiddenClick() {
                document.getElementById("TransactionFormSales:cmdbvPrint").click();
            }
            function doSearchClick() {
                document.getElementById("TransactionFormSales:cmdbSearch").click();
            }
            function doPrintHiddenClickOrder() {
                document.getElementById("TransactionFormSales:cmdbvPrintOrder").click();
            }
        </script> 
    </h:head>
    <f:metadata>
        <f:viewAction action="#{accCurrencyBean.refreshCurrencyListActive()}"/>
        <f:viewAction action="#{navigationBean.checkAccessDenied(utilityBean.convertIntAsString(16), 'View')}"/>
        <f:viewAction action="#{navigationBean.checkLicenseExpired()}"/>
        <f:viewAction action="#{transBean.initClearAllCEC('PARENT',trans,transItemBean.activeTransItems,transItem,itemBean.selectedItem,transactorBean.selectedTransactor,2,transactorBean.selectedBillTransactor,userDetailBean.selectedUserDetail,transactorBean.selectedSchemeTransactor)}" />
        <f:viewAction action="#{transBean.initCurrencyCode(11,trans)}"/>
        <f:viewAction action="#{transBean.initTransType(11,16)}"/>
        <f:viewAction action="#{transBean.initQuickOrderManageFilter(trans)}"/>
        <f:viewAction action="#{transBean.refreshTransListQuickOrderManage(trans)}"/>
        <f:viewAction action="#{transBean.setOutputNumber(0)}"/>
    </f:metadata>
    <f:event listener="#{navigationBean.checkCurrentPage('SALE ORDER','','')}" type="preRenderView" />
    <f:event listener="#{statusBean.initClearStatus()}" type="preRenderView" />
    <h:body>
        <ui:include src="Menu.xhtml"/>
        <h:form id="TransactionFormSales" styleClass="clsMainFrom" style="width:100%;border: 1px solid;" onkeypress="if (event.keyCode == 13)
                    return false;">  
            <h:panelGrid id="pnlHeader" styleClass="clsGridMainHeader" columns="7" style="width:100%;float:left;">
                <h:panelGrid id="pnlStatus" columns="5" style="border-bottom-style: solid;border-bottom: 1;border-bottom-color: white;">
                    <h:commandButton style="border-radius: 5px;border: none;width: 60px;height:45px;font-size: 16px;background-color:#{transBean.setBgColorByStatus(trans.is_processed)};" value="Proc." title="Processed">
                        <f:ajax listener="#{transBean.updateStatus(trans,'PROCESSED')}" execute="@this" render="pnlStatus"/>
                    </h:commandButton>
                    <h:commandButton style="border-radius: 5px;border: none;width: 60px;height:45px;font-size: 16px;background-color:#{transBean.setBgColorByStatus(trans.is_invoiced)};" value="Inv." title="Invoiced">
                        <f:ajax listener="#{transBean.updateStatus(trans,'INVOICED')}" execute="@this" render="pnlStatus"/>
                    </h:commandButton>
                    <h:commandButton style="border-radius: 5px;border: none;width: 60px;height:45px;font-size: 16px;background-color:#{transBean.setBgColorByStatus(trans.is_paid)};" value="Paid" title="Paid">
                        <f:ajax listener="#{transBean.updateStatus(trans,'PAID')}" execute="@this" render="pnlStatus"/>
                    </h:commandButton>
                    <h:commandButton style="border-radius: 5px;border: none;width: 60px;height:45px;font-size: 16px;background-color:#{transBean.setBgColorByStatus(trans.is_cancel)};" value="Canc." title="Cancelled">
                        <f:ajax listener="#{transBean.updateStatus(trans,'CANCELLED')}" execute="@this" render="pnlStatus"/>
                    </h:commandButton>
                </h:panelGrid>
                <h:panelGrid id="pnlTodayYesturday" columns="2" style="border-bottom-style: solid;border-bottom: 1;border-bottom-color: white;">
                    <h:commandButton style="border-radius: 5px;border: none;width: 90px;height:45px;font-size: 16px;background-color:#{transBean.setBgColorIfEqual('1',transBean.todayoryest,0)};" value="ToDay">
                        <f:ajax listener="#{transBean.updateTodayYesturday(1)}" execute="@this" render="pnlTodayYesturday"/>
                    </h:commandButton>
                    <h:commandButton style="border-radius: 5px;border: none;width: 90px;height:45px;font-size: 16px;background-color:#{transBean.setBgColorIfEqual('2',transBean.todayoryest,0)};" value="Yesturday">
                        <f:ajax listener="#{transBean.updateTodayYesturday(2)}" execute="@this" render="pnlTodayYesturday"/>
                    </h:commandButton>
                </h:panelGrid>
                <h:panelGrid id="pnlItemCategory">
                    <p:commandButton value="#{transBean.getDisplayCategory(trans.category)}" icon="fa fa-fw fa-list" style="min-height: 50px;width: 140px;height:auto;font-size: 16px;word-wrap: break-word !important;white-space:normal;background-color:#{utilityBean.setColorByValueFromZero(trans.category.categoryId,'greater','#007fff','#E2E2E2')};" oncomplete="PF('sbarCategory').show()" />
                </h:panelGrid>
                <h:panelGrid id="pnlStore">
                    <p:commandButton value="#{transBean.getDisplayStore(trans.storeId)}" icon="fa fa-fw fa-list" style="min-height: 50px;width: 140px;height:auto;font-size: 16px;word-wrap: break-word !important;white-space:normal;background-color:#{utilityBean.setColorByValueFromZero(trans.storeId,'greater','#007fff','#E2E2E2')};" oncomplete="PF('sbarStore').show()" />
                </h:panelGrid>
                <h:panelGrid id="pnlUser">
                    <p:commandButton value="#{transBean.getDisplayUserDetail(trans.transactionUserDetailId)}" icon="fa fa-fw fa-list" style="min-height: 50px;width: 140px;height:auto;font-size: 16px;word-wrap: break-word !important;white-space:normal;background-color:#{utilityBean.setColorByValueFromZero(trans.transactionUserDetailId,'greater','#007fff','#E2E2E2')};" oncomplete="PF('sbarUser').show()" />
                </h:panelGrid>
                <h:panelGrid id="pnlLocation">
                    <p:commandButton value="#{transBean.getDisplayLocation(trans.location_id)}" icon="fa fa-fw fa-list" style="min-height: 50px;width: 140px;height:auto;font-size: 16px;word-wrap: break-word !important;white-space:normal;background-color:#{utilityBean.setColorByValueFromZero(trans.location_id,'greater','#007fff','#E2E2E2')};" oncomplete="PF('sbarLocation').show()" />
                </h:panelGrid>
                <h:panelGrid columns="2" style="float: right;">
                    <p:commandButton icon="fa fa-fw fa-search" style="width: 120px;height: 55px;color: white;background-color: black;" id="cmdbSearch" value="SEARCH" actionListener="#{transBean.refreshTransListQuickOrderManage(trans)}" process="@form" update="dtblTransList" onclick="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()"/>
                    <p:commandButton icon="fa fa-fw fa-arrow-left" style="width: 120px;height: 55px;color: white;background-color: black;" id="cmdbNew" value="BACK"  action="#{navigationBean.redirectToSaleOrderQuick()}" />
                </h:panelGrid>
            </h:panelGrid>
            <h:panelGrid id="pnlMessage" columns="4">
                <h:outputLabel id="olblItemAddedStstus" class="clsSuccessStatus" value="#{statusBean.itemAddedStatus}" rendered="#{statusBean.showItemAddedStatus==1}"/>
                <h:outputLabel id="olblItemNotAddedStstus" class="clsFailStatus" value="#{statusBean.itemNotAddedStatus}" rendered="#{statusBean.showItemNotAddedStatus==1}"/>
                <h:outputLabel styleClass="clsActionMessage" id="olblActionMessage" value="#{transBean.actionMessage}"/>
                <h:messages id="msgsMainMessage" style="color: red"/><br/>
            </h:panelGrid>
            <p:growl id="growl1" showDetail="true"/>
            <h:panelGrid id="pnlOrders" columns="2">
                <p:dataTable rowIndexVar="rowIndex" id="dtblTransList" value="#{transBean.transList}" var="t" 
                             tableStyle="width:auto;" 
                             rowStyleClass="#{(t.is_paid) eq 1 ? 'green' : (t.is_invoiced) eq 1 ? 'amber' : 'red'}"
                             sortBy="#{1}"
                             >  
                    <p:column style="width: 100px;">
                        <!-- column header -->
                        <f:facet name="header">
                            Order
                        </f:facet>
                        <!-- row record -->
                        <p:commandLink value="#{t.delivery_mode} #{t.transactionNumber}" actionListener="#{transBean.viewOrderOutput(t)}" style="color: white;text-decoration:#{t.is_cancel eq 1 ? 'line-through':'none'};" process="@form" update="@form"/>
                    </p:column>
                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">
                            Item(s)
                        </f:facet>
                        <!-- row record -->
                        <h:outputText value="#{t.transItemsString}" style="text-decoration:#{t.is_cancel eq 1 ? 'line-through':'none'};"/>
                    </p:column>
                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">Ordered By</f:facet>
                        <!-- row record -->
                        <h:outputText value="#{t.transactionUserDetailName} (#{t.storeName})" style="text-decoration:#{t.is_cancel eq 1 ? 'line-through':'none'};"/>
                    </p:column>
                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">#{menuItemBean.menuItemObj.CUSTOMER_NAME}</f:facet>
                        <!-- row record -->
                        <h:outputText value="#{t.transactorName} #{t.location_name}" style="text-decoration:#{t.is_cancel eq 1 ? 'line-through':'none'};"/>
                    </p:column>
                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">Sent To</f:facet>
                        <!-- row record -->
                        <h:outputText value="#{t.store2Name}" style="text-decoration:#{t.is_cancel eq 1 ? 'line-through':'none'};"/>
                    </p:column>
                    <p:column style="text-align: right;">
                        <!-- column header -->
                        <f:facet name="header">Total</f:facet>
                        <!-- row record -->
                        <h:outputText value="#{t.grandTotal}" style="width: 30px;text-decoration:#{t.is_cancel eq 1 ? 'line-through':'none'};">
                            <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                    </p:column>
                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">Date</f:facet>
                        <!-- row record -->
                        <h:outputText value="#{utilityBean.formatDateTime(t.addDate)}" style="text-decoration:#{t.is_cancel eq 1 ? 'line-through':'none'};"/>
                    </p:column>
                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">Proc.</f:facet>
                        <!-- row record -->
                        <h:outputText value="#{t.is_processed eq 1 ? 'Y':'N'}" style="text-decoration:#{t.is_cancel eq 1 ? 'line-through':'none'};"/>
                    </p:column>
                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">Inv.</f:facet>
                        <!-- row record -->
                        <h:outputText value="#{t.is_invoiced eq 1 ? 'Y':'N'} #{t.transactionComment}" style="text-decoration:#{t.is_cancel eq 1 ? 'line-through':'none'};"/>
                    </p:column>
                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">Paid</f:facet>
                        <!-- row record -->
                        <h:outputText value="#{t.is_paid eq 1 ? 'Y':'N'}" style="text-decoration:#{t.is_cancel eq 1 ? 'line-through':'none'};"/>
                    </p:column>
                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">Select</f:facet>
                        <!-- row record -->
                        <h:commandButton style="min-height: 45px;min-width: 45px;border-radius: 5px;border: none;font-size: 12px;word-wrap: break-word !important;white-space:normal;color: black;background-color:#{t.is_selected eq 1 ? '#007fff' : '#E2E2E2'};">
                            <f:ajax listener="#{transBean.updateIs_selected(t)}" render="TransactionFormSales:dtblTransList"/>
                        </h:commandButton>
                    </p:column>
                    <p:summaryRow>
                        <p:column colspan="5" style="text-align:right">
                            <h:outputText value="Total" />
                        </p:column>
                        <p:column>
                            <h:outputText value="#{transBean.orderSummaryTotal}">
                                <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                        </p:column>
                        <p:column colspan="5">
                        </p:column>
                    </p:summaryRow>
                </p:dataTable>
                <h:panelGrid id="pnlButtons" columns="1">
                    <p:keyboard placeholder="User Code" id="keybUserCode" value="#{trans.user_code}" password="true" layout="custom" layoutTemplate="123-close,456-clear,789-back,0" showMode="button" style="width: 110px;height: 30px;border-color: red;"/>
                    <p:commandButton id="cmdbProcess" icon="fa fa-fw fa-thumbs-o-up" title="Process" value="Process" style="width: 120px;height: 55px;float: left;">
                        <p:ajax listener="#{transBean.quickOrderActions(trans,transBean.transList,'Process')}" process="@form" update="dtblTransList growl1"/>
                    </p:commandButton>
                    <p:commandButton id="cmdbPay" icon="fa fa-fw fa-money" title="Pay (fully paid order)" value="Pay" style="width: 120px;height: 55px;float: left;" actionListener="#{transBean.quickOrderActions(trans,transBean.transList,'Pay')}" process="@form" update="dtblTransList frmMenu growl1 pnlgOutput1 pnlgOutput2"/>
                    <p:commandButton id="cmdbInvoice" icon="fa fa-fw fa-save" title="Invoice (partial/no pay or different payment method)" value="Invoice" style="width: 120px;height: 55px;float: left;" actionListener="#{transBean.quickOrderActions(trans,transBean.transList,'Invoice')}" process="@form" update="@form frmMenu growl1"/>
                    <p:commandButton id="cmdbCancel" icon="fa fa-fw fa-remove" title="Cancel" value="Cancel" style="width: 120px;height: 55px;float: left;">
                        <p:ajax listener="#{transBean.quickOrderActions(trans,transBean.transList,'Cancel')}" process="@form" update="dtblTransList growl1"/>
                    </p:commandButton>
                    <p:commandButton id="cmdbMerge" icon="fa fa-fw fa-compress" title="Merge" value="Merge" style="width: 120px;height: 55px;float: left;">
                        <p:ajax listener="#{transBean.quickOrderActions(trans,transBean.transList,'Merge')}" process="@form" update="dtblTransList growl1"/>
                    </p:commandButton>
                    <p:commandButton id="cmdbEdit" icon="fa fa-fw fa-edit" title="Edit" value="Edit" style="width: 120px;height: 55px;float: left;">
                        <p:ajax listener="#{transBean.quickOrderActions(trans,transBean.transList,'Edit')}" process="@form" update="dtblTransList growl1"/>
                    </p:commandButton>
                </h:panelGrid>
            </h:panelGrid>
            <p:dialog id="pnlgOutput1" widgetVar="dlgInvoice" header="Create Invoice from Order" modal="true" width="720" height="320" maximizable="true">
                <p:ajax event="close" listener="#{transBean.clickSearchButton()}" process="@form" update="TransactionFormSales:dtblTransList"/>
                <ui:include src="SaleOrderChildInvoiceTrans.xhtml"/>
            </p:dialog>
            <p:dialog widgetVar="dlgOrder" header="View Order" modal="true" width="400" height="420" maximizable="true">
                <ui:include src="#{transBean.getPrintFileName('PARENT',transactionTypeBean.getTransactionType(11),0)}"/>
            </p:dialog>
            <h:panelGrid id="pnlgOutput2">
                <c:if test="#{transBean.outputNumber==2}">
                    <ui:include src="#{transBean.getPrintFileName('PARENT',transactionTypeBean.getTransactionType(2),0)}"/>
                </c:if>
            </h:panelGrid>
            <p:sidebar widgetVar="sbarCategory" position="right" baseZIndex="10000">
                <h1 style="font-weight:bolder">Item Category Filter</h1>
                <h:panelGrid columns="2">
                    <h:panelGrid id="pnlCategories" columns="1">
                        <c:forEach var="cat" items="#{transItemBean.categoryList}">
                            <h:commandButton style="min-height: 60px;border-radius: 5px;border: none;width: 120px;height:auto;font-size: 20px;word-wrap: break-word !important;white-space:normal;color: black;" value="#{cat.categoryName}">
                                <f:ajax listener="#{trans.setCategory(cat)}" execute="@this" render="TransactionFormSales:pnlItemCategory TransactionFormSales:pnlCategories"/>
                            </h:commandButton>
                        </c:forEach>
                    </h:panelGrid>
                    <h:panelGrid columns="1">
                        <p:commandButton actionListener="#{trans.setCategory(null)}" value="CLEAR" oncomplete="PF('sbarCategory').hide()" update="TransactionFormSales:pnlItemCategory TransactionFormSales:pnlCategories" style="height: 60px;width: 120px;background-color: black;color: white;"/>
                        <p:commandButton value="CLOSE" oncomplete="PF('sbarCategory').hide()" style="height: 60px;width: 120px;background-color: black;color: white;"/>
                    </h:panelGrid>
                </h:panelGrid>
            </p:sidebar>
            <p:sidebar widgetVar="sbarStore" position="right" baseZIndex="10000">
                <h1 style="font-weight:bolder">Store (From/To)</h1>
                <h:panelGrid columns="2">
                    <h:panelGrid id="pnlStores" columns="1">
                        <c:forEach var="st" items="#{transBean.storeList}">
                            <h:commandButton style="width: 100px;min-height:40px;font-size: 12px;word-wrap: break-word;white-space:normal;border: none;border-radius: 5px;" value="#{st.storeName}">
                                <f:ajax listener="#{trans.setStoreId(st.storeId)}" render="TransactionFormSales:pnlStore TransactionFormSales:pnlStores"/>
                            </h:commandButton>
                        </c:forEach>
                    </h:panelGrid>
                    <h:panelGrid columns="1">
                        <p:commandButton actionListener="#{trans.setStoreId(0)}" value="CLEAR" oncomplete="PF('sbarStore').hide()" update="TransactionFormSales:pnlStore TransactionFormSales:pnlStores" style="height: 60px;width: 120px;background-color: black;color: white;"/>
                        <p:commandButton value="CLOSE" oncomplete="PF('sbarStore').hide()" style="height: 60px;width: 120px;background-color: black;color: white;"/>
                    </h:panelGrid>
                </h:panelGrid>
            </p:sidebar>
            <p:sidebar widgetVar="sbarUser" position="right" baseZIndex="10000">
                <h1 style="font-weight:bolder">User Filter</h1>
                <h:panelGrid columns="2">
                    <h:panelGrid id="pnlUsers" columns="1">
                        <c:forEach var="ud" items="#{transBean.userDetailList}">
                            <h:commandButton style="width: 100px;min-height:40px;font-size: 12px;word-wrap: break-word;white-space:normal;border: none;border-radius: 5px;" value="#{ud.userName}">
                                <f:ajax listener="#{trans.setTransactionUserDetailId(ud.userDetailId)}" render="TransactionFormSales:pnlUser TransactionFormSales:pnlUsers"/>
                            </h:commandButton>
                        </c:forEach>
                    </h:panelGrid>
                    <h:panelGrid columns="1">
                        <p:commandButton actionListener="#{trans.setTransactionUserDetailId(0)}" value="CLEAR" oncomplete="PF('sbarUser').hide()" update="TransactionFormSales:pnlUser TransactionFormSales:pnlUsers" style="height: 60px;width: 120px;background-color: black;color: white;"/>
                        <p:commandButton value="CLOSE" oncomplete="PF('sbarUser').hide()" style="height: 60px;width: 120px;background-color: black;color: white;"/>
                    </h:panelGrid>
                </h:panelGrid>
            </p:sidebar>
            <p:sidebar widgetVar="sbarLocation" position="right" baseZIndex="10000">
                <h1 style="font-weight:bolder">Location</h1>
                <h:panelGrid columns="2">
                    <p:scrollPanel mode="native" style="width:220px;height:500px">
                        <h:panelGrid id="pnlLocations" columns="2">
                            <c:forEach var="loc" items="#{transBean.locationList}">
                                <h:commandButton style="width: 100px;min-height:40px;font-size: 12px;word-wrap: break-word;white-space:normal;border: none;border-radius: 5px;" value="#{loc.locationName}">
                                    <f:ajax listener="#{trans.setLocation_id(loc.locationId)}" render="TransactionFormSales:pnlLocation TransactionFormSales:pnlLocations"/>
                                </h:commandButton>
                            </c:forEach>
                        </h:panelGrid>
                    </p:scrollPanel>
                    <h:panelGrid columns="1">
                        <p:commandButton actionListener="#{trans.setLocation_id(0)}" value="CLEAR" oncomplete="PF('sbarLocation').hide()" update="TransactionFormSales:pnlLocation TransactionFormSales:pnlLocations" style="height: 60px;width: 120px;background-color: black;color: white;"/>
                        <p:commandButton value="CLOSE" oncomplete="PF('sbarLocation').hide()" style="height: 60px;width: 120px;background-color: black;color: white;"/>
                    </h:panelGrid>
                </h:panelGrid>
            </p:sidebar>
            <p:dialog widgetVar="statusDialog" height="100" position="center" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                <p:graphicImage name="/images/ajax-loader.gif"/>
            </p:dialog>
        </h:form>
    </h:body>
</html>

