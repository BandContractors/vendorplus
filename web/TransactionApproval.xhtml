<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Transaction Approval</title>
        <link href="resources/images/sys_icon.ico" rel="shortcut icon" type="image/x-icon" />         
        <link rel="stylesheet" type="text/css" href="style.css?ln=css"/>
        <script  language="javascript">
            function confirmDelete()
            {
                return confirm('Are you sure you want to delete this current record?');
            }
            function alertSave()
            {
                return alert('Record saved successfully!');
            }
        </script>
    </h:head>
    <f:metadata>
        <f:viewAction action="#{navigationBean.checkAccessDenied(utilityBean.convertIntAsString(generalUserSetting.currentTransactionReasonId), 'View')}"/>
        <f:viewAction action="#{transaction_approvalBean.getFilteredTransactionApprovals()}"/>
    </f:metadata> 
    <h:body>
        <ui:include src="Menu.xhtml"/>
        <h:form id="form">
            <!--Filter-->
            <h:panelGrid id="pnlgFilter" columns="1" styleClass="clsPanelReportFilter">
                <h:panelGrid id="filter" columns="10">
                    <p:outputLabel value="#{langsys['Store']}"/>
                    <p:selectOneMenu value="#{transaction_approvalBean.filterStore}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItems value="#{storeBean.getStores()}" var="s" itemLabel="#{s.storeName}" itemValue="#{s.storeId}"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="#{langsys['Transaction']} #{langsys['Type']}"/>
                    <p:selectOneMenu value="#{transaction_approvalBean.filterTransactionType}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItems value="#{transactionTypeBean.getTransactionTypes()}" var="tt" itemLabel="#{tt.transactionTypeName}" itemValue="#{tt.transactionTypeId}"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="#{langsys['Requested']} #{langsys['By']}"/>
                    <p:selectOneMenu value="#{transaction_approvalBean.filterRequestedBy}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                    </p:selectOneMenu>
                    <h:outputLabel  value="#{langsys['Request']} #{langsys['Date']}:"/>
                        <p:calendar value="#{transaction_approvalBean.filterRequestDate}" pattern="#{companySetting.getDateFormat()}" navigator="true" showButtonPanel="true" readonlyInput="false" autocomplete="off" inputStyle="width: 150px" style="width: 350px" />
                    <p:outputLabel value="#{langsys['Approval']} #{langsys['Status']}"/>
                    <p:selectOneMenu value="#{transaction_approvalBean.filterApprovalStatus}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItem itemLabel="Submitted" itemValue="0"/>
                        <f:selectItem itemLabel="Approved" itemValue="1"/>
                        <f:selectItem itemLabel="Processed" itemValue="2"/>
                        <f:selectItem itemLabel="Rejected" itemValue="3"/>
                        <f:selectItem itemLabel="Recalled" itemValue="4"/>
                    </p:selectOneMenu>
                    <p:commandButton value="#{langsys['OK']}" style="color: white; background-color: #00B259; width: 80px">
                        <f:ajax listener="#{transaction_approvalBean.getFilteredTransactionApprovals()}" execute="@form" render="@form"/>
                    </p:commandButton>
                    <p:commandButton value="#{langsys['Clear']}" style="color: white; background-color: #FF0000; width: 80px" >
                        <f:ajax listener="#{transaction_approvalBean.clearFilter()}" execute="@form" render="@form"/>
                    </p:commandButton>
                </h:panelGrid>
            </h:panelGrid>

            <p:dataTable id="dtblTransactionApproval" tableStyle="width:auto;" value="#{transaction_approvalBean.transaction_approvalList}" var="ta"                           
                         paginator="true" rows="50" 
                         paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {Exporters}" 
                         rowsPerPageTemplate="50,100,400,800,1000,2000">
                <f:facet name="header">
                    #{itemBean.itemsList.size()} #{langsys['Records']} #{langsys['Found']}
                    <p:commandButton id="toggler" type="button" value="Columns" icon="ui-icon-calculator" />
                    <p:columnToggler datasource="dtblTransactionApproval" trigger="toggler" />
                </f:facet>
                <f:facet name="{Exporters}">
                    <h:commandLink>
                        <p:graphicImage name="images/excel.png" width="24"/>
                        <p:dataExporter type="xls" target="dtblTransactionApproval" fileName="TransactionApproval" />
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/pdf.png" width="24"/>
                        <p:dataExporter type="pdf" target="dtblTransactionApproval" fileName="TransactionApproval"/>
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/csv.png" width="24"/>
                        <p:dataExporter type="csv" target="dtblTransactionApproval" fileName="TransactionApproval" />
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/xml.png" width="24"/>
                        <p:dataExporter type="xml" target="dtblTransactionApproval" fileName="TransactionApproval" />
                    </h:commandLink>
                </f:facet>
                <p:column headerText="#{langsys['Transaction']} #{langsys['Type']}">
                    <h:outputText value="#{transactionTypeBean.getTransactionType(ta.transaction_type_id).getTransactionTypeName()}"/>
                </p:column>
                <p:column headerText="#{langsys['Transaction']} #{langsys['Reason']}">
                    <h:outputText value="#{transactionReasonBean.getTransactionReason(ta.transaction_reason_id).getDescription()}"/>
                </p:column>
                <p:column headerText="#{langsys['Request']} #{langsys['Date']}">
                    <h:outputText value="#{utilityBean.formatDate(ta.request_date)}"/>
                </p:column>
                <p:column headerText="#{langsys['Request']} #{langsys['By']}" visible="false">
                    <h:outputText value="#{ta.request_by_id}"/>
                </p:column>
                <p:column headerText="#{langsys['Approval']} #{langsys['Status']}">
                    <h:outputText value="#{ta.approval_status eq 0 ? 'Submitted' : ta.approval_status eq 1 ? 'Approved' : ta.approval_status eq 2 ? 'Processed' : ta.approval_status eq 3 ? 'Rejected' : 'Recalled'}" />
                </p:column>
                <p:column headerText="#{langsys['Status']} #{langsys['Date']}">
                    <h:outputText value="#{utilityBean.formatDate(ta.status_date)}"/>
                </p:column>
                <p:column headerText="#{langsys['Status']} #{langsys['Description']}">
                    <h:outputText value="#{ta.status_desc}"/>
                </p:column>
                <p:column headerText="#{langsys['Status']} #{langsys['By']}" visible="false">
                    <h:outputText value="#{ta.status_by_id}"/>
                </p:column>
                <p:column headerText="#{langsys['Grand']} #{langsys['Total']}" style="text-align: right;">
                    <h:outputText value="#{ta.grand_total}">
                        <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="#{langsys['Transactor']}">
                    <h:outputText value="#{ta.transactor_names}"/>
                </p:column>
                <p:column headerText="#{langsys['Currency']}">
                    <h:outputText value="#{ta.currency_code}"/>
                </p:column>
                <p:column headerText="#{langsys['Transactor']}" visible="false">
                    <h:outputText value="#{transactorBean.findTransactor(ta.transactor_id).getTransactorNames()}"/>
                </p:column>
                <p:column headerText="#{langsys['Store']}">
                    <h:outputText value="#{storeBean.getStore(ta.store_id).getStoreName()}"/>
                </p:column>
                <p:column headerText="#{langsys['Amount']}" style="text-align: right;" visible="false">
                    <h:outputText value="#{ta.amount_tendered}">
                        <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="#{langsys['Action']}" exportable="false" style="min-width: 125px">
                    <p:commandButton update="form:modalTransactionApprovalDetail" actionListener="#{transaction_approvalBean.displayTransactionApproval(ta,transaction_approval)}" oncomplete="PF('dlgTransactionApprovalDetail').show();" icon="ui-icon-note" title="View Request" style="color: white;" >
                    </p:commandButton>
                    &nbsp;
                    <p:commandButton update="form:dtblTransactionApproval form:growl1" actionListener="#{transaction_approvalBean.markApproved(ta.transaction_approval_id)}" icon="ui-icon-star" title="Approve Request" style="color: white; background-color: #00B259" >
                    </p:commandButton>
                    &nbsp;
                    <p:commandButton update="form:dtblTransactionApproval form:growl1" actionListener="#{transaction_approvalBean.markRejected(ta.transaction_approval_id)}" icon="ui-icon-cancel" title="Cancel Request" style="color: white; background-color: red !important" >
                    </p:commandButton>
                    &nbsp;
                </p:column>

            </p:dataTable>
            <p:dialog rendered="true" dynamic="true" header="#{langsys['TransactionApproval']} #{langsys['Detail']}" widgetVar="dlgTransactionApprovalDetail" id="modalTransactionApprovalDetail" modal="true">
                <h:panelGroup id="popupDetail">
                    <!--<h:outputText value="This is a Modal Dialog." />-->
                    <h:panelGrid columns="2">
                        <h:outputLabel  value="#{langsys['Transaction']} #{langsys['Type']}:"/>
                    <h:outputText value="#{transactionTypeBean.getTransactionType(transaction_approval.transaction_type_id).getTransactionTypeName()}"/>
                        <h:outputLabel  value="#{langsys['Transaction']} #{langsys['Reason']}:"/>
                    <h:outputText value="#{transactionReasonBean.getTransactionReason(transaction_approval.transaction_reason_id).getDescription()}"/>
                        <h:outputLabel  value="#{langsys['Request']} #{langsys['Date']}:"/>
                        <h:outputText  value="#{utilityBean.formatDate(transaction_approval.request_date)}"/>
                        <h:outputLabel  value="#{langsys['Approval']} #{langsys['Status']}:"/>
                    <h:outputText value="#{transaction_approval.approval_status eq 0 ? 'Submitted' : transaction_approval.approval_status eq 1 ? 'Approved' : transaction_approval.approval_status eq 2 ? 'Processed' : transaction_approval.approval_status eq 3 ? 'Rejected' : 'Recalled'}" />
                        <h:outputLabel value="#{langsys['Status']} #{langsys['Date']}:"/>
                        <h:outputText  value="#{utilityBean.formatDate(transaction_approval.status_date)}"/>
                        <h:outputLabel value="#{langsys['Status']} #{langsys['Description']}:"/>
                        <h:outputText  value="#{transaction_approval.status_desc}"/>
                        <h:outputLabel  value="#{langsys['Status']} #{langsys['By']}:"/>
                        <h:outputText  value="#{transaction_approval.status_by_id}"/>
                        <h:outputLabel value="#{langsys['Grand']} #{langsys['Total']}:"/>
                        <h:outputText  value="#{transaction_approval.grand_total}">
                            <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                        <h:outputLabel  value="#{langsys['Transactor']}:"/>
                        <h:outputText  value="#{transaction_approval.transactor_names}"/>
                        <h:outputLabel  value="#{langsys['Currency']}:"/>
                        <h:outputText  value="#{transaction_approval.currency_code}"/>
                        <h:outputLabel  value="#{langsys['Transactor']}:"/>
                        <h:outputText  value="#{transactorBean.findTransactor(ta.transactor_id).getTransactorNames()}"/>
                        <h:outputLabel  value="#{langsys['Store']} #{langsys['Date']}:"/>
                        <h:outputText  value="#{storeBean.getStore(ta.store_id).getStoreName()}"/>
                        <h:outputLabel value="#{langsys['Amount']} #{langsys['Tendered']}:"/>
                        <h:outputText  value="#{transaction_approval.amount_tendered}">
                            <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                    </h:panelGrid>

                </h:panelGroup>
            </p:dialog>

        </h:form>
    </h:body>
</html>

