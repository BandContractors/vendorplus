<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Transaction Approval</title>
        <link href="resources/images/arrow.png" rel="shortcut icon" type="image/x-icon" />         
        <link rel="stylesheet" type="text/css" href="style.css?ln=css"/>
        <script  language="javascript">
            function confirmDelete()
            {
                return confirm('Are you sure you want to delete this current record?');
            }
            function alertSave()
            {
                return alert('Record saved successfully!');
            }
        </script>
    </h:head>
    <f:metadata>
        <f:viewAction action="#{navigationBean.checkAccessDenied(utilityBean.convertIntAsString(130), 'View')}"/>
        <f:viewAction action="#{transaction_approvalBean.getFilteredTransactionApprovals()}"/>
    </f:metadata> 
    <h:body>
        <ui:include src="Menu.xhtml"/>
        <h:form id="form">
            <!--Filter-->
            <h:panelGrid id="pnlgFilter" columns="1" styleClass="clsPanelReportFilter">
                <h:panelGrid id="filter" columns="10">
                    <p:outputLabel value="#{langsys['Store']}"/>
                    <p:selectOneMenu value="#{transaction_approvalBean.filterStore}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItems value="#{storeBean.getStores()}" var="s" itemLabel="#{s.storeName}" itemValue="#{s.storeId}"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="#{langsys['Transaction']} #{langsys['Type']}"/>
                    <p:selectOneMenu value="#{transaction_approvalBean.filterTransactionType}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItems value="#{transactionTypeBean.getTransactionTypes()}" var="tt" itemLabel="#{tt.transactionTypeName}" itemValue="#{tt.transactionTypeId}"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="#{langsys['Requested']} #{langsys['By']}"/>
                    <p:selectOneMenu value="#{transaction_approvalBean.filterRequestedBy}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItems value="#{userDetailBean.getUserDetails()}" var="ud" itemLabel="#{ud.userName}" itemValue="#{ud.userDetailId}"/>
                    </p:selectOneMenu>
                    <h:outputLabel  value="#{langsys['Request']} #{langsys['Date']}:"/>
                    <p:calendar value="#{transaction_approvalBean.filterRequestDate}" pattern="#{companySetting.getDateFormat()}" navigator="true" showButtonPanel="true" readonlyInput="false" autocomplete="off" inputStyle="width: 150px" style="width: 350px" />
                    <p:outputLabel value="#{langsys['Approval']} #{langsys['Status']}"/>
                    <p:selectOneMenu value="#{transaction_approvalBean.filterApprovalStatus}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue="-1"/>
                        <f:selectItem itemLabel="Submitted" itemValue="0"/>
                        <f:selectItem itemLabel="Approved" itemValue="1"/>
                        <f:selectItem itemLabel="Processed" itemValue="2"/>
                        <f:selectItem itemLabel="Rejected" itemValue="3"/>
                        <f:selectItem itemLabel="Recalled" itemValue="4"/>
                    </p:selectOneMenu>
                    <p:commandButton value="#{langsys['OK']}" style="color: white; background-color: #7BC043; width: 80px">
                        <f:ajax listener="#{transaction_approvalBean.getFilteredTransactionApprovals()}" execute="@form" render="@form"/>
                    </p:commandButton>
                    <p:commandButton value="#{langsys['CLEAR']}" style="color: white; background-color: #FF0000; width: 80px" >
                        <f:ajax listener="#{transaction_approvalBean.clearFilter()}" execute="@form" render="@form"/>
                    </p:commandButton>
                </h:panelGrid>
            </h:panelGrid>

            <p:dataTable id="dtblTransactionApproval" tableStyle="width:auto;" value="#{transaction_approvalBean.transaction_approvalList}" var="ta"                           
                         paginator="true" rows="50" 
                         paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {Exporters}" 
                         rowsPerPageTemplate="50,100,400,800,1000,2000"
                         rowStyleClass="#{ta.approval_status eq 1 ? 'amber' : ta.approval_status eq 2 ? 'green' : ta.approval_status eq 3 ? 'red' : ta.approval_status eq 4 ? 'blue' : 'none' }">
                <f:facet name="header">
                    #{itemBean.itemsList.size()} #{langsys['Records']} #{langsys['Found']}
                    <p:commandButton id="toggler" type="button" value="Columns" icon="ui-icon-calculator" />
                    <p:columnToggler datasource="dtblTransactionApproval" trigger="toggler" />
                </f:facet>
                <f:facet name="{Exporters}">
                    <h:commandLink>
                        <p:graphicImage name="images/excel.png" width="24"/>
                        <p:dataExporter type="xls" target="dtblTransactionApproval" fileName="TransactionApproval" />
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/pdf.png" width="24"/>
                        <p:dataExporter type="pdf" target="dtblTransactionApproval" fileName="TransactionApproval"/>
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/csv.png" width="24"/>
                        <p:dataExporter type="csv" target="dtblTransactionApproval" fileName="TransactionApproval" />
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/xml.png" width="24"/>
                        <p:dataExporter type="xml" target="dtblTransactionApproval" fileName="TransactionApproval" />
                    </h:commandLink>
                </f:facet>
                <p:column headerText="#{langsys['Id']}">
                    <h:outputText value="#{ta.transaction_approval_id}"/>
                </p:column>
                <p:column headerText="#{langsys['Store']}">
                    <h:outputText value="#{storeBean.getStore(ta.store_id).getStoreName()}"/>
                </p:column>
                <p:column headerText="#{langsys['Transaction']} #{langsys['Type']}">
                    <h:outputText value="#{transactionTypeBean.getTransactionType(ta.transaction_type_id).getTransactionTypeName()} / #{transactionReasonBean.getTransactionReason(ta.transaction_reason_id).getTransactionReasonName()}"/>
                </p:column>
                <p:column headerText="#{langsys['Request']} #{langsys['Date']}">
                    <h:outputText value="#{utilityBean.formatDate(ta.request_date)}"/>
                </p:column>
                <p:column headerText="#{langsys['Request']} #{langsys['By']}">
                    <h:outputText value="#{userDetailBean.getUserDetail(ta.request_by_id).userName}"/>
                </p:column>
                <p:column headerText="#{langsys['Status']}">
                    <h:outputText value="#{ta.approval_status eq 0 ? 'Submitted' : ta.approval_status eq 1 ? 'Approved' : ta.approval_status eq 2 ? 'Processed' : ta.approval_status eq 3 ? 'Rejected' : 'Recalled'}" />
                </p:column>
                <p:column headerText="#{langsys['Status']} #{langsys['Date']}" visible="false">
                    <h:outputText value="#{utilityBean.formatDate(ta.status_date)}"/>
                </p:column>
                <p:column headerText="#{langsys['Status']} #{langsys['Description']}" visible="false">
                    <h:outputText value="#{ta.status_desc}"/>
                </p:column>
                <p:column headerText="#{langsys['Comment']}">
                    <h:outputText value="#{ta.status_comment}"/>
                </p:column>
                <p:column headerText="#{langsys['Status']} #{langsys['By']}" visible="false">
                    <h:outputText value="#{userDetailBean.getUserDetail(ta.status_by_id).userName}"/>
                </p:column>
                <p:column headerText="#{langsys['Currency']}" visible="false">
                    <h:outputText value="#{ta.currency_code}"/>
                </p:column>
                <p:column headerText="#{langsys['Partner']}">
                    <h:outputText value="#{transactorBean.getTransactor(ta.transactor_id).getTransactorNames()}"/>
                </p:column>
                <p:column headerText="#{langsys['Grand']} #{langsys['Total']}" style="text-align: right;">
                    <h:outputText value="#{ta.grand_total}">
                        <f:convertNumber pattern="###,###,###.########" locale="#{utilityBean.convertLocaleToString()}"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="#{langsys['Amount']} #{langsys['Tendered']}" style="text-align: right;">
                    <h:outputText value="#{ta.amount_tendered}">
                        <f:convertNumber pattern="###,###,###.########" locale="#{utilityBean.convertLocaleToString()}"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="#{langsys['Action']}" exportable="false" style="min-width: 125px">
                    <p:commandButton update="form:modalTransactionApprovalDetail" actionListener="#{transaction_approvalBean.displayTransactionApproval(ta,transaction_approval)}" oncomplete="PF('dlgTransactionApprovalDetail').show();" icon="ui-icon-note" title="View Request" style="color: white;" >
                    </p:commandButton>
                    &nbsp;
                    <p:commandButton rendered="#{ta.approval_status eq 0}" update="form:modalTransactionApprovalComment" actionListener="#{transaction_approvalBean.displayTransactionApprovalCall(ta,transaction_approval,0)}" oncomplete="PF('dlgTransactionApprovalComment').show();" icon="ui-icon-check" title="Approve Request" style="color: white; background-color: #7BC043" >
                    </p:commandButton>
                    &nbsp;
                    <p:commandButton rendered="#{ta.approval_status eq 0}" update="form:modalTransactionApprovalComment" actionListener="#{transaction_approvalBean.displayTransactionApprovalCall(ta,transaction_approval,1)}" oncomplete="PF('dlgTransactionApprovalComment').show();" icon="ui-icon-close" title="Cancel Request" style="color: white; background-color: red !important" >
                    </p:commandButton>
                    &nbsp;
                </p:column>

            </p:dataTable>
            <p:dialog rendered="true" dynamic="true" header="#{langsys['Transaction']} #{langsys['Approval']} #{langsys['Detail']}" widgetVar="dlgTransactionApprovalDetail" id="modalTransactionApprovalDetail" modal="true">
                <h:panelGroup id="popupDetail">

                    <!--items-->
                    <h:panelGrid id="vTransactionGrid">
                        <h:panelGrid id="IpgrdSalesInvoice" columns="1">
                            <h:panelGrid columns="1" style=" margin: 0px;background-color: gray;text-align: center;-webkit-print-color-adjust: exact;">
                                <h:outputLabel style="font-family:'Trebuchet MS', 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', Tahoma, sans-serif; font-size: 18pt;color:#FFFFFF;font-weight: bold;text-decoration: none;">#{langout[transactionTypeBean.getTransactionType(transaction_approval.transaction_type_id).getTransactionOutputLabel()]}</h:outputLabel>
                            </h:panelGrid>

                            <h:panelGrid id="IpgrdSalesInvoiceStatus" style="margin: 0px;" columns="2">
                                <h:outputLabel style="font-size: 12px; font-weight: bold;" value="#{langsys['Approval']} #{langsys['Status']}:"/>
                                <h:outputLabel style="font-size: 12px; font-weight: bold;" value="#{transaction_approval.approval_status eq 0 ? 'Submitted' : transaction_approval.approval_status eq 1 ? 'Approved' : transaction_approval.approval_status eq 2 ? 'Processed' : transaction_approval.approval_status eq 3 ? 'Rejected' : 'Recalled'}" />
                                <h:outputLabel style="font-size: 12px;" value="#{langsys['Comment']}:" rendered="#{transaction_approval.status_comment.length()>0}"/>
                                <h:outputLabel style="font-size: 12px;" value="#{transaction_approval.status_comment}" rendered="#{transaction_approval.status_comment.length()>0}" />
                            </h:panelGrid>

                            <h:panelGrid style="width: 290px; margin: 0px;" columns="2" rendered="#{transaction_approval.transaction_id>0}">
                                <h:outputLabel style="font-size: 12px;" value="#{langout[transactionTypeBean.getTransactionType(transaction_approval.transaction_type_id).getTransactionNumberLabel()]}:"/>
                                <h:outputLabel style="font-size: 20px;font-weight: bold;" value="#{transBean.getTrans(transaction_approval.transaction_id).getTransactionNumber()}"/>
                                <h:outputLabel style="font-size: 12px;" value="#{langout[transactionTypeBean.getTransactionType(transaction_approval.transaction_type_id).getTransactionRefLabel()]}:" rendered="#{transBean.getTrans(transaction_approval.transaction_id).getTransactionRef().length()>0}"/>
                                <h:outputLabel style="font-size: 12px;font-weight: bold;" value="#{transBean.getTrans(transaction_approval.transaction_id).getTransactionRef()}" rendered="#{transBean.getTrans(transaction_approval.transaction_id).getTransactionRef().length()>0}"/>
                                <h:outputLabel style="font-size: 12px;" value="#{langout[transactionTypeBean.getTransactionType(transaction_approval.transaction_type_id).getTransactionDateLabel()]}:"/>
                                <h:outputLabel style="font-size: 12px;" value="#{utilityBean.formatDateTime(transBean.getTrans(transaction_approval.transaction_id).getAddDate())}"/>
                            </h:panelGrid>

                            <h:panelGrid style=" margin: 0px;" columns="2" rendered="#{transaction_approval.transactor_id>0}">
                                <h:outputLabel style="font-size: 12px;" value="#{langout[menuItemBean.menuItemObj.CUSTOMER_NAME]}:"/>
                                <h:outputLabel style="font-size: 12px;" value="#{transactorBean.findTransactor(transaction_approval.transactor_id).getTransactorNames()}"/>
                                <h:outputLabel style="font-size: 12px;" value="#{langout['Tax']} #{langout['Id']} #{langout['No.']}:" rendered="#{transactorBean.findTransactor(transaction_approval.transactor_id).taxIdentity.length()>0}"/>
                                <h:outputLabel style="font-size: 12px;" value="#{transactorBean.findTransactor(transaction_approval.transactor_id).taxIdentity}" rendered="#{transactorBean.findTransactor(transaction_approval.transactor_id).taxIdentity.length()>0}"/>
                                <h:outputLabel style="font-size: 12px;" value="#{langout['Phone']}:" rendered="#{transactorBean.findTransactor(transaction_approval.transactor_id).phone.length()>0}"/>
                                <h:outputLabel style="font-size: 12px;" value="#{transactorBean.findTransactor(transaction_approval.transactor_id).phone}" rendered="#{transactorBean.findTransactor(transaction_approval.transactor_id).phone.length()>0}"/>
                            </h:panelGrid>

                            <h:panelGrid id="IpgrdSalesInvoiceItems">
                                <p:dataTable id="IdtblSalesInvoiceItems" tableStyle="width:auto;"  value="#{transaction_approvalBean.transItemList}" var="ti"                                                                  
                                             paginator="false" 
                                             paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {Exporters}" 
                                             rowsPerPageTemplate="50,100,400,800,1000,2000"> 
                                    <p:column>
                                        <!-- column header -->
                                        <f:facet name="header">#{langout['ITEMS']}(#{transaction_approvalBean.transItemList.size()})</f:facet>
                                        <!-- row record -->
                                        <h:outputLabel style="font-size: 12px;" value="#{itemBean.findItem(ti.itemId).getDescription()}" escape="false" />
                                        <h:outputLabel style="font-size: 10px;" value=" BN:#{ti.batchno}" escape="false" rendered="#{ti.batchno.length() gt 0 and parameter_listBean.getParameter_listByContextNameMemory('INVOICE','SHOW_BATCH_ON_PRINTOUT').parameter_value eq '1'}"/>
                                        <h:outputLabel style="font-size: 10px;" value=" ED:#{utilityBean.formatDate(ti.itemExpryDate)}" escape="false" rendered="#{ti.itemExpryDate.toString().length() gt 0 and parameter_listBean.getParameter_listByContextNameMemory('INVOICE','SHOW_BATCH_ON_PRINTOUT').parameter_value eq '1'}"/>
                                    </p:column>
                                    <p:column>
                                        <!-- column header -->
                                        <f:facet name="header">#{langout['QTY']}(#{utilityBean.formatNumber('###,###,###.########',transItemBean.getTransItemsTotalQty(transaction_approvalBean.transItemList))})</f:facet>
                                        <!-- row record -->
                                        <h:outputLabel style="font-size: 10px;" value="#{ti.itemQty}">
                                            <f:convertNumber pattern="###,###,###.########" locale="#{utilityBean.convertLocaleToString()}"/>
                                        </h:outputLabel> 
                                        <h:outputLabel style="font-size: 10px;" value="#{unitBean.getUnit(ti.unit_id).unitSymbol}"/>
                                        <h:outputLabel style="font-size: 10px;" value="@" rendered="#{ti.hide_unit_price_invoice eq 0}"/>
                                        <h:outputLabel style="font-size: 10px;" value="#{ti.unitPriceIncVat}" rendered="#{ti.hide_unit_price_invoice eq 0}">
                                            <f:convertNumber pattern="###,###,###.########" locale="#{utilityBean.convertLocaleToString()}"/>
                                        </h:outputLabel>
                                    </p:column>
                                    <p:column>
                                        <!-- column header -->
                                        <f:facet name="header">#{langout['AMOUNT']}</f:facet>
                                        <!-- row record -->
                                        <h:outputLabel style="font-size: 12px;" value="#{ti.amountIncVat}">
                                            <f:convertNumber pattern="###,###,###.########" locale="#{utilityBean.convertLocaleToString()}"/>
                                        </h:outputLabel>
                                    </p:column>
                                </p:dataTable>
                            </h:panelGrid>

                            <h:panelGrid id="IpgrdSalesInvoiceTotals" style=" margin: 0px;" columns="2">
                                <h:outputLabel style="font-size: 12px; font-weight: bold;" value="#{langout['TOTAL']} (#{transBean.getTransFromHist(transaction_approval.transaction_hist_id).currencyCode}):"/>
                                <h:outputLabel style="font-size: 12px; font-weight: bold;" id="IolblSalesInvoiceGrandTotal" value="#{transaction_approval.grand_total}">
                                    <f:convertNumber pattern="#{accCurrencyBean.getNumberFormatByCurrency(transBean.getTransFromHist(transaction_approval.transaction_hist_id).currencyCode)}" locale="#{utilityBean.convertLocaleToString()}"/>
                                </h:outputLabel>
                                <h:outputLabel style="font-size: 12px; font-weight: bold;" value="#{langout['TENDERED']} #{langout['AMOUNT']}:"/>
                                <h:outputLabel style="font-size: 12px; font-weight: bold;" id="IolblSalesInvoiceAmountTendered" value="#{transaction_approval.amount_tendered}">
                                    <f:convertNumber pattern="###,###,###.########" locale="#{utilityBean.convertLocaleToString()}"/>
                                </h:outputLabel>
                            </h:panelGrid>

                            <h:panelGrid id="IpgrdSalesInvoiceFooter12" style=" margin: 0px;" columns="2">
                                <h:outputLabel value="#{langout['Added']} #{langout['by']}: "/>
                                <h:outputLabel value="#{userDetailBean.getUserDetail(transaction_approval.request_by_id).firstName} #{userDetailBean.getUserDetail(transaction_approval.request_by_id).secondName}"/>
                                <h:outputLabel style="font-size: 12px;" value="#{langout['Add']} #{langout['Date']}:"/>
                                <h:outputLabel style="font-size: 12px;" value="#{utilityBean.formatDateTime(transaction_approval.request_date)}"/>
                            </h:panelGrid>
                        </h:panelGrid>
                    </h:panelGrid>

                </h:panelGroup>
            </p:dialog>
            <p:dialog rendered="true" dynamic="true" header="#{langsys['Transaction']} #{langsys['Approval']}" widgetVar="dlgTransactionApprovalComment" id="modalTransactionApprovalComment" modal="true">
                <h:panelGrid id="popupComment">
                    <p:outputLabel value="#{langsys['Comment']}" style=""/>
                    <p:inputTextarea value="#{transaction_approval.status_comment}" style="width: 400px" />
                </h:panelGrid>

                <h:panelGrid columns="1">
                    <h:panelGrid  columns="2">
                        <p:commandButton rendered="#{transaction_approvalBean.approveOrRejectButton==0}" update="form:dtblTransactionApproval form:growl1" actionListener="#{transaction_approvalBean.markApprovedCall(transaction_approval)}" value="#{langsys['Approve']}" style="color: white; background-color: #7BC043" onclick="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()">
                        </p:commandButton>
                        <p:commandButton rendered="#{transaction_approvalBean.approveOrRejectButton==1}" update="form:dtblTransactionApproval form:growl1" actionListener="#{transaction_approvalBean.markRejectedCall(transaction_approval)}" value="#{langsys['Reject']}" style="color: white; background-color: #7BC043" onclick="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()">
                        </p:commandButton>
                        <p:commandButton value="#{langsys['CANCEL']}" style="color: white; background-color: #FF0000" onsuccess="PF('dlgTransactionApprovalComment').hide()">
                        </p:commandButton>
                    </h:panelGrid>
                </h:panelGrid>
            </p:dialog>
            <p:growl id="growl1"/>
        </h:form>
    </h:body>
</html>

