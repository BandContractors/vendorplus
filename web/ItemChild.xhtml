<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <title>Item</title>
        <link href="resources/images/sys_icon.ico" rel="shortcut icon" type="image/x-icon" />         
        <link rel="stylesheet" type="text/css" href="style.css?ln=css"/>
        <script  type="text/javascript">
            function confirmDelete()
            {
                return confirm('Are you sure you want to delete this current record?');
            }
            function alertSave()
            {
                return alert('Record saved successfully!');
            }
        </script> 
    </h:head>
    <f:event listener="#{accCurrencyBean.initCurrencyList()}" type="preRenderView" />
    <f:event listener="#{navigationBean.checkAccessDenied('8', 'View')}" type="preRenderView" />
    <f:event listener="#{itemBean.initClearItem(itemBean.itemObj,itemBean.itemsList)}" type="preRenderView" />
    <f:event listener="#{itemBean.initStockLocation()}" type="preRenderView" />
    <f:event listener="#{itemBean.initItemObj()}" type="preRenderView" />
    <h:body>
        <h:form enctype="multipart/form-data" id="formMain" styleClass="clsMainFrom" onkeypress="if (event.keyCode == 13)
                    return false;">
            <h:panelGrid id="pnlgHeader" styleClass="clsGridMainHeader" columns="1">
                <h:outputLabel styleClass="clsLabelTop" id="olblcategoryHeader" value="#{generalUserSetting.currentItemPurpose} Item Detail"/>
            </h:panelGrid>

            <h:panelGrid id="pnlgBarCode" columns="2">  
                <h:panelGrid id="gnlgBarCodeOnly" rendered="#{itemBean.itemObj.itemCode.length()>0}">  
                    <p:barcode id="barcItemCode" value="#{itemBean.itemObj.itemCode}" type="code128" style="width: 176px;height: 128px;"/>
                </h:panelGrid>
                <p:commandLink value="Print.Bar.Code" rendered="#{itemBean.itemObj.itemCode.length()>0}">
                    <p:printer target="gnlgBarCodeOnly" rendered="false"/>
                </p:commandLink>
            </h:panelGrid>
            <div class="ui-fluid">
                <h:panelGrid id="pnlgItemDetail" styleClass="clsGridMainInput" columns="6">
                    <h:outputLabel value="Currency:"/>
                    <h:selectOneMenu id="menuCurrency" value="#{itemBean.itemObj.currencyCode}" style="width: 200px">
                        <f:selectItems value="#{accCurrencyBean.currencyList}" var="ac" itemLabel="#{ac.currencyCode}" itemValue="#{ac.currencyCode}"/>
                        <f:ajax event="change" execute="@this" render="@this"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Is Suspended?"/>
                    <h:selectOneMenu id="menuIsSuspended" value="#{itemBean.itemObj.isSuspended}" style="width: 200px">
                        <f:selectItem itemLabel="No" itemValue="No"/>
                        <f:selectItem itemLabel="Yes" itemValue="Yes"/>
                    </h:selectOneMenu>

                    <h:outputLabel value="Asset Item?"/>
                    <h:selectOneMenu id="menuIsAsset" value="#{itemBean.itemObj.isAsset}" style="width: 200px;background-color: #{listOptionBean.getColorByItemsNo(listOptionBean.getItemAssetOptions().size())}">
                        <f:selectItems value="#{listOptionBean.getItemAssetOptions()}" var="sa" itemLabel="#{sa.strOption2}" itemValue="#{sa.intOption1}"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Item Type:"/>
                    <h:selectOneMenu id="menuItemType" value="#{itemBean.itemObj.itemType}" style="width: 200px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItem itemLabel="PRODUCT" itemValue="PRODUCT"/>
                        <f:selectItem itemLabel="SERVICE" itemValue="SERVICE"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="VAT Rated"/>
                    <h:selectOneMenu id="menuVatRated" value="#{itemBean.itemObj.vatRated}" style="width: 200px">
                        <f:selectItem itemLabel="STANDARD" itemValue="STANDARD"/>
                        <f:selectItem itemLabel="ZERO" itemValue="ZERO"/>
                        <f:selectItem itemLabel="EXEMPT" itemValue="EXEMPT"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Asset Type:"/>
                    <h:selectOneMenu id="menuAssetType" value="#{itemBean.itemObj.assetType}" style="width: 200px;background-color: #{listOptionBean.getColorByBoolean(generalUserSetting.currentItemPurpose.equals('Asset'))}" disabled="#{!generalUserSetting.currentItemPurpose.equals('Asset')}">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItem itemLabel="Land" itemValue="LAND"/>
                        <f:selectItem itemLabel="Building" itemValue="BUILDING"/>
                        <f:selectItem itemLabel="Machinery and Equipment" itemValue="MACHINE"/>
                        <f:selectItem itemLabel="Vehicle" itemValue="VEHICLE"/>
                        <f:selectItem itemLabel="Furniture and Fixtures" itemValue="FURNITURE"/>
                        <f:selectItem itemLabel="Computer Equipment" itemValue="COMPUTER"/>
                        <f:selectItem itemLabel="Other Fixed Asset" itemValue="OTHER"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Item Code:"/>
                    <h:inputText id="itxtCode" value="#{itemBean.itemObj.itemCode}" autocomplete="off" style="width: 200px"/>
                    <h:outputLabel value="Is General?"/>
                    <h:selectOneMenu id="menuIsGeneral" value="#{itemBean.itemObj.isGeneral}" style="width: 200px">
                        <f:selectItem itemLabel="No" itemValue="0"/>
                        <f:selectItem itemLabel="Yes" itemValue="1"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Asset Account:"/>
                    <h:selectOneMenu id="menuAssetAccountCode" value="#{itemBean.itemObj.assetAccountCode}" style="width: 200px;background-color: #{listOptionBean.getColorByBoolean(generalUserSetting.currentItemPurpose.equals('Asset'))}" disabled="#{!generalUserSetting.currentItemPurpose.equals('Asset')}">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItems value="#{accCoaBean.getAccCoaObjectListBeginWith1('1-20-000')}" var="ac" itemLabel="#{ac.accountName}" itemValue="#{ac.accountCode}"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Description:"/>
                    <h:inputText id="itxtDescription" value="#{itemBean.itemObj.description}" autocomplete="off" style="width: 200px"/>
                    <h:outputLabel value="Alias Name:"/>
                    <h:inputText id="itxtAliasName" value="#{itemBean.itemObj.alias_name}" autocomplete="off" style="width: 200px"/>
                    <h:outputLabel value="Display Alias?"/>
                    <h:selectOneMenu id="menuDisplayAliasName" value="#{itemBean.itemObj.display_alias_name}" style="width: 200px">
                        <f:selectItem itemLabel="No" itemValue="0"/>
                        <f:selectItem itemLabel="Yes" itemValue="1"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Category:"/>
                    <h:selectOneMenu id="menuCategory" value="#{itemBean.itemObj.categoryId}" style="width: 200px">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{categoryBean.categories}" var="c" itemLabel="#{c.categoryName}" itemValue="#{c.categoryId}"/>
                        <f:ajax event="change" render="menuSubCategory"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="SubCategory:"/>
                    <h:selectOneMenu id="menuSubCategory" value="#{itemBean.itemObj.subCategoryId}" style="width: 200px">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{subCategoryBean.getSubCategoriesByCategoryId(itemBean.itemObj.categoryId)}" var="s" itemLabel="#{s.subCategoryName}" itemValue="#{s.subCategoryId}"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Expense Type:"/>
                    <h:selectOneMenu id="menuExpenseType" value="#{itemBean.itemObj.expense_type}" style="width: 200px;background-color: #{listOptionBean.getColorByBoolean(generalUserSetting.currentItemPurpose.equals('Expense'))}" disabled="#{!generalUserSetting.currentItemPurpose.equals('Expense')}">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItem itemLabel="Raw Material" itemValue="Raw Material"/>
                        <f:selectItem itemLabel="Consumption" itemValue="Consumption"/>
                        <f:ajax event="change" render="menuExpenseAccountCode"/>
                    </h:selectOneMenu>                   
                    <h:outputLabel value="Unit:"/>
                    <h:selectOneMenu id="menuUnit" value="#{itemBean.itemObj.unitId}" style="width: 200px">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{unitBean.units}" var="u" itemLabel="#{u.unitName}" itemValue="#{u.unitId}"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Re-order Level:"/>
                    <h:inputText id="itxtReorderLevel" value="#{itemBean.itemObj.reorderLevel}" autocomplete="off" style="width: 200px">
                    </h:inputText>
                    <h:outputLabel value="Expense Account:"/>
                    <h:selectOneMenu id="menuExpenseAccountCode" value="#{itemBean.itemObj.expenseAccountCode}" style="width: 200px;background-color: #{listOptionBean.getColorByBoolean(generalUserSetting.currentItemPurpose.equals('Expense'))}" disabled="#{!generalUserSetting.currentItemPurpose.equals('Expense')}">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <c:if test="#{itemBean.itemObj.expense_type.equals('Consumption')}">
                            <f:selectItems value="#{accCoaBean.getAccCoaObjectListBeginWith2('5-20','5-30')}" var="ea" itemLabel="#{ea.accountName}" itemValue="#{ea.accountCode}"/>
                        </c:if>
                        <c:if test="#{itemBean.itemObj.expense_type.equals('Raw Material')}">
                            <f:selectItems value="#{accCoaBean.getAccCoaObjectListBeginWith1('5-10-000-070')}" var="ea" itemLabel="#{ea.accountName}" itemValue="#{ea.accountCode}"/>
                        </c:if>
                    </h:selectOneMenu>
                    <h:outputLabel value="Retailsale Price:"/>
                    <h:inputText id="itxtUnitRetailsalePrice" value="#{itemBean.itemObj.unitRetailsalePrice}" autocomplete="off" style="width: 200px"/>
                    <h:outputLabel value="Unit Cost Price:"/>
                    <h:inputText id="itxtUnitCostPrice" value="#{itemBean.itemObj.unitCostPrice}" autocomplete="off" style="width: 200px"/>
                    <h:outputLabel value="Is Free?"/>
                    <h:selectOneMenu id="menuIsFree" value="#{itemBean.itemObj.is_free}" style="width: 200px">
                        <f:selectItem itemLabel="No" itemValue="0"/>
                        <f:selectItem itemLabel="Yes" itemValue="1"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Wholesale Price:"/>
                    <h:inputText id="itxtUnitWholesalePrice" value="#{itemBean.itemObj.unitWholesalePrice}" autocomplete="off" style="width: 200px"/>
                    <h:outputLabel value="Special Price:"/>
                    <h:inputText id="itxtUnitSpecialsalePrice" value="#{itemBean.itemObj.unit_special_price}" autocomplete="off" style="width: 200px"/>
                    <h:outputLabel value="I Hire this Item?"/>
                    <h:selectOneMenu id="menuIsHire" value="#{itemBean.itemObj.is_hire}" style="width: 200px;">
                        <f:selectItem itemLabel=""/>
                        <f:selectItem itemLabel="Yes" itemValue="1"/>
                        <f:selectItem itemLabel="No" itemValue="0"/>  
                        <f:ajax event="change" execute="@this" render="itxtUnitHirePrice"/> 
                    </h:selectOneMenu>
                    <h:outputLabel value="I Track this Item?"/>
                    <h:selectOneMenu id="menuIsTrack" value="#{itemBean.itemObj.isTrack}" style="width: 200px">
                        <f:selectItem itemLabel=""/>
                        <f:selectItem itemLabel="No" itemValue="0"/>
                        <f:selectItem itemLabel="Yes" itemValue="1"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Image Full Name:"/>
                    <h:inputText id="itxtImageName" value="#{itemBean.itemObj.itemImgUrl}" autocomplete="off" style="width: 200px"/>
                    <h:outputLabel value="Unit HirePrice/#{generalUserSetting.DEFAULT_DURATION_TYPE}:"/>
                    <h:inputText id="itxtUnitHirePrice" value="#{itemBean.itemObj.unit_hire_price}" autocomplete="off" style="width: 200px" disabled="#{itemBean.itemObj.is_hire==0}"/>
                    <h:outputLabel value="I Buy this Item?"/>
                    <h:selectOneMenu id="menuIsBuy" value="#{itemBean.itemObj.isBuy}" style="width: 200px">
                        <f:selectItem itemLabel="Yes" itemValue="1"/>
                        <f:selectItem itemLabel="No" itemValue="0"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="I Sell this Item?"/>
                    <h:selectOneMenu id="menuIsSale" value="#{itemBean.itemObj.isSale}" style="width: 200px;background-color: #{listOptionBean.getColorByItemsNo(listOptionBean.getItemSaleOptions().size())}">
                        <f:selectItems value="#{listOptionBean.getItemSaleOptions()}" var="sa" itemLabel="#{sa.strOption2}" itemValue="#{sa.intOption1}"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Unit Weight(#{parameter_listBean.getParameter_listByContextNameMemory('ITEM','DEFAULT_MEASURE_UNIT').parameter_value}):"/>
                    <h:inputText value="#{itemBean.itemObj.unit_weight}" autocomplete="off" style="width: 200px"/>
                    
                    <h:outputLabel value="Expiry Band (U,H,M,L):"/>
                    <p:selectOneMenu id="menuExpiryBand" value="#{itemBean.itemObj.expiry_band}" style="width: 200px" editable="true">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItem itemLabel="0030,0060,0120,0180" itemValue="0030,0060,0120,0180"/>
                    </p:selectOneMenu>
                    <h:outputLabel value="Specify Size?"/>
                    <h:selectOneMenu id="menuSpecifySize" value="#{itemBean.itemObj.specify_size}" style="width: 200px">
                        <f:selectItem itemLabel="No" itemValue="0"/>
                        <f:selectItem itemLabel="Yes" itemValue="1"/>
                    </h:selectOneMenu>
                    <h:outputLabel value="Size to Name?"/>
                    <h:selectOneMenu id="menuSizeToSpecificName" value="#{itemBean.itemObj.size_to_specific_name}" style="width: 200px">
                        <f:selectItem itemLabel="No" itemValue="0"/>
                        <f:selectItem itemLabel="Yes" itemValue="1"/>
                    </h:selectOneMenu>
                </h:panelGrid>
                <!--
                <h:panelGrid columns="2">
                    <h:outputLabel value="Product Image:"/>
                    <h:inputFile value="#{itemBean.file}">
                    </h:inputFile>
                </h:panelGrid>
                -->
                <h:panelGrid id="pnlLocationStock" columns="4" style="width: 980px;">
                    <h:outputLabel value="Located:"/>
                    <h:dataTable id="dtblLocation" value="#{itemBean.locationList}" var="loc" 
                                 styleClass="cls-table" 
                                 headerClass="cls-table-header" 
                                 rowClasses="cls-table-odd-row,cls-table-even-row" 
                                 columnClasses="cls-table-col1,cls-table-col2,cls-table-col3,cls-table-col4"
                                 > 
                        <h:column>
                            <!-- column header -->
                            <f:facet name="header">#{companySetting.getStoreEquivName()}</f:facet>
                            <!-- row record -->
                            #{storeBean.getStore(loc.storeId).storeName}
                        </h:column>

                        <h:column>
                            <!-- column header -->
                            <f:facet name="header">Location</f:facet>
                            <!-- row record -->
                            #{loc.locationName}
                        </h:column>
                    </h:dataTable>

                    <h:outputLabel value="Stock:"/>
                    <h:dataTable id="dtblStock" value="#{itemBean.stockList}" var="stck" 
                                 styleClass="cls-table" 
                                 headerClass="cls-table-header" 
                                 rowClasses="cls-table-odd-row,cls-table-even-row" 
                                 columnClasses="cls-table-col1,cls-table-col2,cls-table-col3,cls-table-col4,cls-table-col5"
                                 > 
                        <h:column>
                            <!-- column header -->
                            <f:facet name="header">#{companySetting.getStoreEquivName()}</f:facet>
                            <!-- row record -->
                            #{storeBean.getStore(stck.storeId).storeName}
                        </h:column>
                        <h:column>
                            <!-- column header -->
                            <f:facet name="header">Qty</f:facet>
                            <!-- row record -->
                            #{stck.currentqty}
                        </h:column>
                        <h:column>
                            <!-- column header -->
                            <f:facet name="header">BatchNo</f:facet>
                            <!-- row record -->
                            #{stck.batchno}
                        </h:column>
                        <h:column>
                            <!-- column header -->
                            <f:facet name="header">Specific Name/Code</f:facet>
                            <!-- row record -->
                            #{stck.codeSpecific} #{stck.descSpecific}
                        </h:column>
                        <h:column>
                            <!-- column header -->
                            <f:facet name="header">Exp.Date</f:facet>
                            <!-- row record -->
                            <h:outputText value="#{utilityBean.formatDate(stck.itemExpDate)}"/>
                        </h:column>
                    </h:dataTable>
                </h:panelGrid>
            </div>
            <h:panelGrid styleClass="clsGridMainCommands" columns="1">
                <h:panelGrid styleClass="clsGridMainCommands1" columns="3">
                    <p:commandButton styleClass="clsButtonBig" id="cmdbSave" value="SAVE (ALT+S)" accesskey="s" onclick="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()">
                        <p:dialog widgetVar="statusDialog" height="100" position="center" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                            <p:graphicImage name="/images/ajax-loader.gif"/>
                        </p:dialog>
                        <p:ajax listener="#{itemBean.saveItem()}" process="@form" update="@this pnlgBarCode pnlgItemDetail pnlLocationStock pnlgMessage growl1 pnlgSearch dtblItem" />
                    </p:commandButton>
                    <p:commandButton styleClass="clsButtonBig" id="cmdbClear" value="CLEAR (ALT+C)" accesskey="c">
                        <p:ajax listener="#{itemBean.clearItem()}" process="@form" update="pnlgBarCode pnlgItemDetail pnlLocationStock pnlgMessage growl1 pnlgSearch dtblItem"/>
                    </p:commandButton>
                </h:panelGrid>
            </h:panelGrid>

            <h:panelGrid id="pnlgMessage" styleClass="clsGridMainMessages" columns="1">
                <h:outputLabel styleClass="clsActionMessage" id="olblActionMessage" value="#{itemBean.actionMessage}"/>
                <h:messages id="msgsMainMessage" style="color: red"/><br/>
            </h:panelGrid>
            <p:growl id="growl1"/>

            <h:panelGrid id="pnlgSearch" styleClass="clsGridMainSearch" columns="3">
                <h:outputLabel id="olblMainSearch" value="Type Description or Code to Search #{generalUserSetting.currentItemPurpose} Item"/>
                <h:inputText id="itxtMainSearch" value="#{itemBean.searchItemDesc}" autocomplete="off">
                    <f:ajax event="keyup" listener="#{itemBean.refreshItemsList(itemBean.searchItemDesc)}" render="dtblItem"/>
                </h:inputText>
                <h:outputLabel value="(Only TOP 10 Search Results to be displayed)"/>
            </h:panelGrid>

            <p:dataTable id="dtblItem" value="#{itemBean.itemsList}" var="itm" 
                         tableStyle="width:auto;">
                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Type</f:facet>
                    <!-- row record -->
                    #{itm.itemType}
                </p:column>
                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Description</f:facet>
                    <!-- row record -->
                    #{itm.description}
                </p:column>
                <p:column>  
                    <!-- column header -->
                    <f:facet name="header">Alias</f:facet>
                    <!-- row record -->
                    #{itm.alias_name} 
                </p:column>
                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Code</f:facet>
                    <!-- row record -->
                    #{itm.itemCode}
                </p:column>
                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Unit</f:facet>
                    <!-- row record -->
                    #{unitBean.getUnit(itm.unitId).unitSymbol}
                </p:column>
                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Category</f:facet>
                    <!-- row record -->
                    #{categoryBean.getCategory(itm.categoryId).categoryName}
                </p:column>
                <p:column>
                    <!-- column header -->
                    <f:facet name="header">CUR</f:facet>
                    <!-- row record -->
                    #{itm.currencyCode}
                </p:column>
                <p:column>
                    <!-- column header -->
                    <f:facet name="header">General</f:facet>
                    <!-- row record -->
                    #{utilityBean.returnYesNoString(itm.isGeneral)}
                </p:column>
                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Action</f:facet>
                    <!-- row record -->
                    <h:commandLink value="Edit">
                        <f:ajax listener="#{itemBean.displayItem(itm)}" execute="dtblItem" render="formMain:pnlgBarCode formMain:pnlgItemDetail formMain:pnlLocationStock formMain:pnlgMessage formMain:growl1"/>
                    </h:commandLink>
                    &nbsp;
                </p:column>
            </p:dataTable>

        </h:form>
    </h:body>
</html>

