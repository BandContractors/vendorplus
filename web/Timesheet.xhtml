<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Timesheet</title>
        <link href="resources/images/sys_icon.ico" rel="shortcut icon" type="image/x-icon" />         
        <link rel="stylesheet" type="text/css" href="style.css?ln=css"/>
        <script  language="javascript">
            function confirmDelete()
            {
                return confirm('Are you sure you want to delete this current record?');
            }
            function alertSave()
            {
                return alert('Record saved successfully!');
            }
        </script>
    </h:head>
    <f:metadata>
        <f:viewAction action="#{navigationBean.checkAccessDenied(utilityBean.convertIntAsString(generalUserSetting.currentTransactionReasonId), 'View')}"/>
        <f:viewAction action="#{timesheetBean.getFilteredTimesheets()}"/>
    </f:metadata> 
    <h:body>
        <ui:include src="Menu.xhtml"/>
        <h:form id="form">
            <h:panelGrid styleClass="clsPanelReportFilterTitle" columns="4" style="height: 140px">
                <p:commandButton actionListener="#{timesheetBean.clearTimesheet(timesheet)}" value="Timesheet" onsuccess="PF('dlgTimesheet').show();" icon="ui-icon-circle-plus" style="float: none; height: 50px; width: 190px">
                    <f:ajax render="form:modalTimesheet"/>
                </p:commandButton>
                <p:commandButton value="#{langsys['Category']} #{langsys['Activity']}" action="#{navigationBean.redirectToCategoryActivity('Timesheet')}" style="background-color: yellow !important; height: 50px; float: none; width: 190px" />
                <p:commandButton value="#{langsys['Sub']} #{langsys['Activity']} #{langsys['Category']}" action="#{navigationBean.redirectToSubActivityCategory('Timesheet')}" style="background-color: red !important; height: 50px; float: none; width: 190px" />
                <p:commandButton value="#{langsys['Staff']}" action="#{navigationBean.redirectToStaff('Timesheet')}" style="background-color: red !important; float: none; height: 50px; width: 190px" />
                <p:commandButton value="#{langsys['Activity']} #{langsys['Status']}" action="#{navigationBean.redirectToActivityStatus('Timesheet')}" style="background-color: yellow !important; float: none; height: 50px; width: 190px" />
                <p:commandButton value="#{langsys['Project']}" action="#{navigationBean.redirectToProject('Timesheet')}" style="background-color: red !important; float: none; height: 50px; width: 190px;" />
                <p:commandButton value="#{langsys['Mode']} #{langsys['Activity']}" action="#{navigationBean.redirectToMode_activity('Timesheet')}" style="background-color: yellow !important; float: none; height: 50px; width: 190px" />
            </h:panelGrid>

            <!--Filter-->
            <h:panelGrid id="pnlgFilter" columns="1" styleClass="clsPanelReportFilter">
                <h:panelGrid id="filter" columns="10">
                    <p:outputLabel value="#{langsys['From']} #{langsys['Date']}"/>
                    <p:calendar id="fromDate" value="#{timesheetBean.filterFromActivityDate}" style="width: 150px;height: 28px; background-color: white"/>
                    <p:outputLabel value="#{langsys['To']} #{langsys['Date']}"/>
                    <p:calendar id="toDate" value="#{timesheetBean.filterToActivityDate}" style="width: 150px;height: 28px; background-color: white"/>
                    <h:outputLabel  value="#{langsys['Category']} #{langsys['Activity']}:"/>
                    <p:selectOneMenu value="#{timesheetBean.filterCategoryActivityId}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{category_activityBean.getCategory_activities()}" var="ca" itemLabel="#{ca.category_name}" itemValue="#{ca.category_activity_id}"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="#{langsys['Staff']}"/>
                    <p:selectOneMenu value="#{timesheetBean.filterStaffId}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{staffBean.getStaffAll()}" var="s" itemLabel="#{s.first_name} #{s.second_name} #{s.third_name}" itemValue="#{s.staff_id}"/>
                    </p:selectOneMenu>
                    <p:commandButton value="#{langsys['OK']}" style="color: white; background-color: #00B259; width: 120px">
                        <f:ajax listener="#{timesheetBean.getFilteredTimesheets()}" execute="@form" render="@form"/>
                    </p:commandButton>
                    <p:commandButton value="#{langsys['Clear']}" style="color: white; background-color: #FF0000; width: 120px" >
                        <f:ajax listener="#{timesheetBean.clearFilter()}" execute="@form" render="@form"/>
                    </p:commandButton>
                </h:panelGrid>
            </h:panelGrid>

            <h:panelGrid id="pnlgSummary" columns="3" styleClass="clsPanelSummary">
                <p:dataTable id="tblSummaryTimesheetTotalTime" tableStyle="width:100%;" var="sum" value="#{timesheetBean.timesheetSummary_totalTime}">
                    <p:column headerText="#{langsys['Staff']}" width="auto">
                        <h:outputText value="#{sum.first_name} #{sum.second_name}">
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{langsys['Time']} #{langsys['Taken']}" style="text-align: right;" width="auto">
                        <h:outputText value="#{sum.time_taken}">
                            <f:convertNumber/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{langsys['Unit']} #{langsys['Of']} #{langsys['Time']}" width="auto">
                        <h:outputText value="#{sum.unit_of_time}">
                        </h:outputText>
                    </p:column>
                </p:dataTable>
                <p:dataTable id="tblSummaryARH" tableStyle="width:100%;" var="su" value="#{timesheetBean.timesheetSummary_ARH}">
                    <p:column headerText="#{langsys['Staff']}">
                        <h:outputLabel value="#{su.first_name} #{su.second_name}"/>
                    </p:column>
                    <p:column headerText="#{langsys['ARH']}">
                        <h:outputLabel value="#{su.arh}"/>
                    </p:column>
                </p:dataTable>
            </h:panelGrid>

            <p:dataTable id="dtblTimesheet" tableStyle="width:auto;" value="#{timesheetBean.filteredTimesheetList}" var="ts"                           
                         paginator="true" rows="50" 
                         paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {Exporters}" 
                         rowsPerPageTemplate="50,100,400,800,1000,2000">
                <f:facet name="header">
                    #{itemBean.itemsList.size()} #{langsys['Records']} #{langsys['Found']}
                    <p:commandButton id="toggler" type="button" value="Columns" icon="ui-icon-calculator" />
                    <p:columnToggler datasource="dtblTimesheet" trigger="toggler" />
                </f:facet>
                <f:facet name="{Exporters}">
                    <h:commandLink>
                        <p:graphicImage name="images/excel.png" width="24"/>
                        <p:dataExporter type="xls" target="dtblTimesheet" fileName="Timesheet" />
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/pdf.png" width="24"/>
                        <p:dataExporter type="pdf" target="dtblTimesheet" fileName="Timesheet"/>
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/csv.png" width="24"/>
                        <p:dataExporter type="csv" target="dtblTimesheet" fileName="Timesheet" />
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/xml.png" width="24"/>
                        <p:dataExporter type="xml" target="dtblTimesheet" fileName="Timesheet" />
                    </h:commandLink>
                </f:facet>

                <p:column headerText="#{langsys['Transactor']}">
                    <h:outputText value="#{transactorBean.findTransactor(ts.transactor_id).getTransactorNames()}"/>
                </p:column>
                <p:column headerText="#{langsys['Activity']} #{langsys['Category']}">
                    <h:outputText value="#{category_activityBean.getCategory_activity(ts.category_activity_id).getCategory_name()}"/>
                </p:column>
                <p:column headerText="#{langsys['Sub']} #{langsys['Category']} #{langsys['Activity']}">
                    <h:outputText value="#{subcategory_activityBean.getSubcategory_activity(ts.subcategory_activity_id).getSubcategory_name()}"/>
                </p:column>
                <p:column headerText="#{langsys['Staff']}">
                    <h:outputText value="#{staffBean.getStaff(ts.staff_id).getFirst_name()}"/>
                </p:column>
                <p:column headerText="#{langsys['Mode']} #{langsys['Activity']}">
                    <h:outputText value="#{mode_activityBean.getMode_activity(ts.mode_activity_id).getMode_name()}"/>
                </p:column>
                <p:column headerText="#{langsys['Activity']} #{langsys['Name']}">
                    <h:outputText value="#{ts.activity_name}"/>
                </p:column>
                <p:column headerText="#{langsys['Unit']} #{langsys['Of']} #{langsys['Time']}" style="text-align: right;">
                    <h:outputText value="#{ts.unit_of_time}" />
                </p:column>
                <p:column headerText="#{langsys['Activity']} #{langsys['Date']}">
                    <h:outputText value="#{utilityBean.formatDate(ts.activity_date)}"/>
                </p:column>
                <p:column headerText="#{langsys['Time']} #{langsys['Taken']}">
                    <h:outputText value="#{ts.time_taken}">                    
                        <f:convertNumber />
                    </h:outputText>
                </p:column>
                <p:column headerText="#{langsys['Action']}" exportable="false" style="min-width: 125px">
                    <p:commandButton actionListener="#{timesheetBean.displayTimesheet(ts,timesheet)}" oncomplete="PF('dlgTimesheetDetail').show();"
                                     icon="ui-icon-note" title="View Timesheet Detail" style="color: white;" >
                    </p:commandButton>
                    &nbsp;
                    <p:commandButton update="form:modalTimesheet" actionListener="#{timesheetBean.displayTimesheet(ts, timesheet)}" 
                                     oncomplete="PF('dlgTimesheet').show();" icon="ui-icon-pencil" title="Edit Timesheet" style="color: white; background-color: #00B259" >
                    </p:commandButton>
                    &nbsp;
                </p:column>  
            </p:dataTable>

            <!--this is the form-->
            <p:dialog rendered="true" dynamic="true" header="#{langsys['Time']} #{langsys['Sheet']} #{langsys['Detail']}" widgetVar="dlgTimesheet" id="modalTimesheet" modal="true" height="475px">
                <h:panelGroup id="popup">
                    <h:panelGrid columns="4">
                        <h:outputLabel  value="#{langsys['Staff']}:"/>
                        <p:selectOneMenu value="#{timesheet.staff_id}" style="width: 305px">
                            <f:selectItem itemLabel="" itemValue="0"/>
                            <f:selectItems value="#{staffBean.getStaffAll()}" var="s" itemLabel="#{s.first_name} #{s.second_name} #{s.third_name}" itemValue="#{s.staff_id}"/>
                        </p:selectOneMenu>
                        <h:outputLabel  value="#{langsys['Activity']} #{langsys['Name']}:"/>
                        <p:inputText id="activityname" style="width: 320px" value="#{timesheet.activity_name}" autocomplete="off" required="true" requiredMessage="Activity Name Cannot be empty"/>
                        <h:outputLabel value="#{langsys['Time']} #{langsys['Taken']}:"/>
                        <p:inputNumber id="itemAmount" inputStyle="width:320px" style="width: 80000px" value="#{timesheet.time_taken}" decimalPlaces="0" autocomplete="off" required="true" requiredMessage="Time taken Cannot be empty" />
                        <h:outputLabel  value="#{langsys['Unit']} #{langsys['Of']} #{langsys['Time']}:"/>
                        <p:selectOneMenu value="#{timesheet.unit_of_time}" style="width: 305px">
                            <f:selectItem itemLabel="" itemValue=""/>
                            <f:selectItem itemLabel="Hours" itemValue="Hours"/>
                            <f:selectItem itemLabel="Minutes" itemValue="Minutes"/>
                            <f:selectItem itemLabel="Days" itemValue="Days"/>
                        </p:selectOneMenu>
                        <h:outputLabel  value="#{langsys['Activity']} #{langsys['Status']}:"/>
                        <p:selectOneMenu value="#{timesheet.activity_status}" style="width: 305px">
                            <f:selectItem itemLabel="" itemValue=""/>
                            <f:selectItem itemLabel="Ongoing" itemValue="Ongoing"/>
                            <f:selectItem itemLabel="Completed" itemValue="Ongoing"/>
                            <f:selectItem itemLabel="Pending" itemValue="Pending"/>
                        </p:selectOneMenu>
                        <h:outputLabel  value="#{langsys['Mode']} #{langsys['Activity']}:"/>
                        <p:selectOneMenu value="#{timesheet.mode_activity_id}" style="width: 305px">
                            <f:selectItem itemLabel="" itemValue="0"/>
                            <f:selectItems value="#{mode_activityBean.getMode_activityAll()}" var="ma" itemLabel="#{ma.mode_name}" itemValue="#{ma.mode_activity_id}"/>
                        </p:selectOneMenu>
                        <h:outputLabel  value="#{langsys['Category']} #{langsys['Activity']}:"/>
                        <p:selectOneMenu value="#{timesheet.category_activity_id}" style="width: 305px">
                            <f:selectItem itemLabel="" itemValue="0"/>
                            <f:selectItems value="#{category_activityBean.getCategory_activities()}" var="ca" itemLabel="#{ca.category_name}" itemValue="#{ca.category_activity_id}"/>
                            <f:ajax event="change" render="subCategoryActivity"/>
                        </p:selectOneMenu>
                        <h:outputLabel  value="#{langsys['Sub']} #{langsys['Category']} #{langsys['Activity']}:"/>
                        <p:selectOneMenu id="subCategoryActivity" value="#{timesheet.subcategory_activity_id}" style="width: 305px">
                            <f:selectItem itemLabel="" itemValue="0"/>
                            <f:selectItems value="#{subcategory_activityBean.getSubcategory_activityByCategoryActivityId(timesheet.category_activity_id)}" var="sca" itemLabel="#{sca.subcategory_name}" itemValue="#{sca.subcategory_activity_id}"/>
                        </p:selectOneMenu>  
                        <h:outputLabel  value="#{langsys['Project']}:"/>
                        <p:selectOneMenu value="#{timesheet.project_id}" style="width: 305px">
                            <f:selectItem itemLabel="" itemValue="0"/>
                            <f:selectItems value="#{projectBean.getProjectAll()}" var="pn" itemLabel="#{pn.project_name}" itemValue="#{pn.project_id}"/>
                        </p:selectOneMenu>
                        <h:outputLabel  value="#{langsys['Transactor']}:"/>
                        <p:autoComplete id="autcTransactor" value="#{timesheet.transactor}" 
                                        completeMethod="#{transactorBean.getTransactorActiveObjectList}" 
                                        var="trct" 
                                        itemLabel="#{trct.transactorNames}" 
                                        itemValue="#{trct}" 
                                        converter="TransactorConverter" style="text-align: left;" 
                                        forceSelection="true" queryDelay="0" inputStyle="width: 320px" 
                                        >
                            <p:column headerText="#{langsys['Names']}" style="text-align: left" >  
                                #{trct.transactorNames} 
                            </p:column>
                        </p:autoComplete>
                        <h:outputLabel  value="#{langsys['Activity']} #{langsys['Date']}:"/>
                        <p:calendar value="#{timesheet.activity_date}" pattern="#{companySetting.getDateFormat()}" navigator="true" showButtonPanel="true" readonlyInput="true" autocomplete="off" inputStyle="width: 320px" style="width: 350px">
                        </p:calendar>
                    </h:panelGrid>

                    <h:panelGrid styleClass="clsGridMainCommands" columns="1">
                        <h:panelGrid styleClass="clsGridMainCommands1" columns="4">
                            <p:commandButton update="pnlgFilter pnlgSummary form:popup form:dtblTimesheet form:growl1" actionListener="#{timesheetBean.saveTimesheet(timesheet)}" styleClass="clsButtonBig" id="cmdbSave" value="#{langsys['SAVE']}" style="color: white; background-color: #00B259" onclick="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()">
                                <p:dialog widgetVar="statusDialog" height="100" position="center" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                                    <p:graphicImage name="/images/ajax-loader.gif"/>
                                </p:dialog>
                            </p:commandButton>
                            <p:commandButton update="form:popup" actionListener="#{timesheetBean.clearTimesheet(timesheet)}" styleClass="clsButtonBig" id="cmdbClear" value="#{langsys['CLEAR']}" style="color: white; background-color: #FF0000">
                            </p:commandButton>
                        </h:panelGrid>
                    </h:panelGrid>

                    <h:panelGrid styleClass="clsGridMainMessages" columns="1">
                        <h:outputLabel styleClass="clsActionMessage" id="olblActionMessage" value="#{timesheetBean.actionMessage}"/>
                        <h:messages id="msgsMainMessage" style="color: green"/><br/>
                    </h:panelGrid>
                    <p:growl id="growl1"/>
                </h:panelGroup>
            </p:dialog>

            <p:dialog rendered="true" dynamic="true" header="#{langsys['Time']} #{langsys['sheet']} #{langsys['Detail']}" widgetVar="dlgTimesheetDetail" id="modalTimesheetDetail" modal="true">
                <h:panelGroup id="popupDetail">
                    <!--<h:outputText value="This is a Modal Dialog." />-->
                    <h:panelGrid columns="2">
                        <h:outputLabel  value="#{langsys['Transactor']}:"/>
                        <h:outputLabel  value="#{subscriptionBean.selectedTransactor.transactorNames}"/>
                        <h:outputLabel  value="#{langsys['Category']} #{langsys['Activity']}:"/>
                        <h:outputText  value="#{category_activityBean.getCategory_activity(timesheet.category_activity_id).getCategory_name()}"/>
                        <h:outputLabel  value="#{langsys['Sub']} #{langsys['Category']} #{langsys['Activity']}:"/>
                        <h:outputText  value="#{subcategory_activityBean.getSubcategory_activity(timesheet.subcategory_activity_id).getSubcategory_name()}"/>
                        <h:outputLabel  value="#{langsys['Staff']}:"/>
                        <h:outputText value="#{staffBean.getStaff(staff.staff_id).getFirst_name()}"/>
                        <h:outputLabel  value="#{langsys['Mode']} #{langsys['Activity']}:"/>
                        <h:outputText  value="#{mode_activityBean.getMode_activity(timesheet.mode_activity_id).getMode_name()}"/>
                        <h:outputLabel  value="#{langsys['Activity']} #{langsys['Name']}:"/>
                        <h:outputText  value="#{timesheet.activity_name}"/>
                        <h:outputLabel value="#{langsys['Unit']} #{langsys['Of']}  #{langsys['Time']}:"/>
                        <h:outputText  value="#{timesheet.unit_of_time}">
                        </h:outputText>
                        <h:outputLabel  value="#{langsys['Activity']} #{langsys['Date']}:"/>
                        <h:outputText  value="#{timesheet.activity_date}"/>
                        <h:outputLabel value="#{langsys['Time']} #{langsys['Taken']}:"/>
                        <h:outputText  value="#{timesheet.time_taken}">
                        </h:outputText>
                    </h:panelGrid>
                </h:panelGroup>
            </p:dialog>
        </h:form>
    </h:body>
</html>

