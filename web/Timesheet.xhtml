<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Timesheet</title>
        <link href="resources/images/sys_icon.ico" rel="shortcut icon" type="image/x-icon" />         
        <link rel="stylesheet" type="text/css" href="style.css?ln=css"/>
        <script  language="javascript">
            function confirmDelete()
            {
                return confirm('Are you sure you want to delete this current record?');
            }
            function alertSave()
            {
                return alert('Record saved successfully!');
            }
        </script>
    </h:head>
    <f:metadata>
        <f:viewAction action="#{navigationBean.checkAccessDenied(utilityBean.convertIntAsString(generalUserSetting.currentTransactionReasonId), 'View')}"/>
        <f:viewAction action="#{subscriptionBean.getFilteredSubscriptions()}"/>
    </f:metadata> 
    <h:body>
        <ui:include src="Menu.xhtml"/>
        <h:form id="form">
            <h:panelGrid styleClass="clsPanelReportFilterTitle" columns="5" style="display: inline-block">
                <p:commandButton actionListener="#{subscriptionBean.clearSubscription(subscription)}" value="Timesheet" onsuccess="PF('dlgSubscription').show();" icon="ui-icon-circle-plus" style="float: none">
                    <f:ajax render="form:modalSubscription"/>
                </p:commandButton>
                <p:commandButton value="#{langsys['Category']} #{langsys['Activity']}" action="#{navigationBean.redirectToCategoryActivity('Timesheet')}" style="background-color: yellow !important; float: none" />
                <p:commandButton value="#{langsys['Sub']} #{langsys['Activity']} #{langsys['Category']}" action="#{navigationBean.redirectToSubActivityCategory('Timesheet')}" style="background-color: red !important; float: none" />
                <p:commandButton value="#{langsys['Staff']}" action="#{navigationBean.redirectToStaff()}" style="background-color: red !important; float: left" />
                <p:commandButton value="#{langsys['Activity']} #{langsys['Status']}" action="#{navigationBean.redirectToActivityStatus()}" style="background-color: red !important; float: none" />
                <p:commandButton value="#{langsys['Project']}" action="#{navigationBean.redirectToProject()}" style="background-color: red !important; float: none" />
                <p:commandButton value="#{langsys['Mode']} #{langsys['Activity']}" action="#{navigationBean.redirectToMode_activity()}" style="background-color: red !important; float: none" />
            </h:panelGrid>

            <h:panelGrid columns="1">
                <!--<h:outputLabel value="Filter" style="font-weight: bolder"/>-->
            </h:panelGrid>

            <!--Filter-->
            <h:panelGrid id="pnlgFilter" columns="1" styleClass="clsPanelReportFilter">
                <h:panelGrid id="filter" columns="10">
                    <p:outputLabel value="#{langsys['Customer']}"/>
                    <p:autoComplete value="#{timesheetBean.filterTransactor}" 
                                    completeMethod="#{transactorBean.getTransactorActiveObjectList}" 
                                    var="trct" 
                                    itemLabel="#{trct.transactorNames}" 
                                    itemValue="#{trct}" 
                                    converter="TransactorConverter" style="text-align: left;" 
                                    forceSelection="true" queryDelay="0" inputStyle="width: 165px"
                                    >
                        <p:column headerText="#{langsys['Activity']} #{langsys['Name']}" style="text-align: left" >  
                            #{trct.transactorNames} 
                        </p:column>
                        <p:column headerText="#{langsys['Reference']} #{langsys['No']}" style="text-align: left" >  
                            #{trct.transactorRef} 
                        </p:column>
                    </p:autoComplete>
                    <p:outputLabel value="#{langsys['Activity']} #{langsys['Status']}"/>
                    <p:selectOneMenu value="#{subscriptionBean.filterStatus}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItem itemLabel="Active" itemValue="Active"/>
                        <f:selectItem itemLabel="Expired" itemValue="Expired"/>
                        <f:selectItem itemLabel="Opted Out" itemValue="Opted Out"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="#{langsys['Sub']} #{langsys['Category']}"/>
                    <p:selectCheckboxMenu id="filterSubscriptionCategory" value="#{subscriptionBean.filterSubscriptionCategoryIds}" dynamic="true" label=" " filter="true" filterMatchMode="startsWith" style="width: 170px;height: 28px; background-color: white" panelStyle="width:250px">
                        <f:selectItems value="#{subscriptionCategoryBean.getSubscriptionCategory()}" var="sc" itemLabel="#{sc.category_name}" itemValue="#{sc.subscription_category_id}"/>
                    </p:selectCheckboxMenu>
                    <p:outputLabel value="#{langsys['Recurring']}"/>
                    <p:selectOneMenu value="#{subscriptionBean.filterRecurring}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItem itemLabel="Yes" itemValue="Yes"/>
                        <f:selectItem itemLabel="No" itemValue="No"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="#{langsys['Staff']}"/>
                    <p:autoComplete value="#{subscriptionBean.filterItem}"  
                                    completeMethod="#{itemBean.getItemObjectListForSale_old}" 
                                    var="itm" 
                                    itemLabel="#{itm.description}" 
                                    itemValue="#{itm}" 
                                    converter="ItemConverter" style="text-align: left" 
                                    forceSelection="true" queryDelay="0" inputStyle="width: 165px"
                                    onkeypress="if (event.keyCode == 13) {
                                                doAddClick();
                                                return false;
                                            }" >
                        <p:column headerText="#{langsys['Item']} #{langsys['Description']}" style="text-align: left" >  
                            #{itm.description} 
                        </p:column>
                        <p:column headerText="#{langsys['Alias']}" style="text-align: left" >  
                            #{itm.alias_name} 
                        </p:column>
                        <p:column headerText="#{langsys['Item']} #{langsys['Code']}" style="text-align: left" >  
                            #{itm.itemCode} 
                        </p:column>
                        <p:column headerText="#{langsys['Unit']}" style="text-align: left">  
                            #{itm.unitSymbol}
                        </p:column> 
                        <p:column headerText="#{langsys['Category']}" style="text-align: left">  
                            #{itm.categoryName}
                        </p:column>
                    </p:autoComplete>
                    <p:outputLabel value="#{langsys['Category']} #{langsys['Activity']} "/>
                    <p:selectCheckboxMenu id="filterActivityCategory" value="#{subscriptionBean.filterBusinessCategoryIds}" dynamic="true" label=" " filter="true" filterMatchMode="startsWith" style="width: 170px;height: 28px; background-color: white" panelStyle="width:250px"/>
                    <f:selectItems value="#{businessCategoryBean.getBusinessCategory()}" var="bc" itemLabel="#{bc.category_name}" itemValue="#{bc.business_category_id}"/>
                    <p:outputLabel value="#{langsys[menuItemBean.menuItemObj.LOC_LEVEL_2_LABEL]}"/>
                    <p:selectOneMenu value="#{subscriptionBean.filterLocDistrict}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItems value="#{transactorBean.getUniqueTransactor_loc_district()}" var="ld" itemLabel="#{ld}" itemValue="#{ld}"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="#{langsys['Staff']}"/>
                    <p:selectOneMenu value="#{subscriptionBean.filterConvertedBy}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItems value="#{subscriptionBean.getUniqueSubscriptionConvertedBys()}" var="c" itemLabel="#{c}" itemValue="#{c}"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="#{langsys['Activity']} #{langsys['Status']}"/>
                    <p:selectOneMenu value="#{subscriptionBean.filterReferredBy}" style="width: 150px">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItems value="#{subscriptionBean.getUniqueSubscriptionReferredBys()}" var="r" itemLabel="#{r}" itemValue="#{r}"/>
                    </p:selectOneMenu>
                    <p:commandButton value="#{langsys['OK']}" style="color: white; background-color: #00B259; width: 180px">
                        <f:ajax listener="#{subscriptionBean.getFilteredSubscriptions()}" execute="@form" render="@form"/>
                    </p:commandButton>
                    <p:commandButton value="#{langsys['Clear']}" style="color: white; background-color: #FF0000; width: 180px" >
                        <f:ajax listener="#{subscriptionBean.clearFilter()}" execute="@form" render="@form"/>
                    </p:commandButton>
                </h:panelGrid>
            </h:panelGrid>

            <h:panelGrid id="pnlgSummary" columns="4" styleClass="clsPanelSummary">
                <p:dataTable id="tblSummaryActivityCategory" tableStyle="width:100%;" var="sum" value="#{subscriptionBean.subscriptionsSummary_businessCategory}">
                    <p:column headerText="#{langsys['Activity']} #{langsys['Category']}">
                        <h:outputLabel value="#{businessCategoryBean.getBusinessCategory(sum.business_category_id).getCategory_name()}"/>
                        <f:facet name="footer">
                            <h:outputText value="Total" />
                        </f:facet>
                    </p:column>
                    <p:column headerText="#{langsys['No']}" width="10%" style="text-align: right;">
                        <h:outputText value="#{sum.description}">
                            <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{subscriptionBean.getTotalNo(subscriptionBean.subscriptionsSummary_businessCategory)}">
                                <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column>
                        <f:facet name="footer">
                            <h:outputText value="#{subscriptionBean.getTotalAmount(subscriptionBean.subscriptionsSummary_businessCategory)}">
                                <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                </p:dataTable>
                <h:panelGrid>
                    <p:dataTable id="tblSummaryStatus" tableStyle="width:100%;" var="sum" value="#{subscriptionBean.subscriptionsSummary_status}" 
                                 rowStyleClass="#{sum.current_status eq 'Active' ? 'green' : sum.current_status eq 'Opted Out' ? 'red' : 'amber'}">
                        <p:column headerText="#{langsys['Status']}">
                            <h:outputLabel value="#{sum.current_status} "/>
                            <f:facet name="footer">
                                <h:outputText value="Total" />
                            </f:facet>
                        </p:column>
                        <p:column headerText="#{langsys['No']}" width="10%" style="text-align: right;">
                            <h:outputText value="#{sum.description}">
                                <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                            <f:facet name="footer">
                                <h:outputText value="#{subscriptionBean.getTotalNo(subscriptionBean.subscriptionsSummary_status)}">
                                    <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                                </h:outputText>
                            </f:facet>
                        </p:column>
                        <p:column>
                            <f:facet name="footer">
                                <h:outputText value="#{subscriptionBean.getTotalAmount(subscriptionBean.subscriptionsSummary_status)}">
                                    <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                                </h:outputText>
                            </f:facet>
                        </p:column>
                    </p:dataTable>
                    <p:dataTable sortBy="#{1}" id="tblSummaryRecurring" tableStyle="width:100%;" var="sum" value="#{subscriptionBean.subscriptionsSummary_recurring}">
                        <p:column headerText="#{langsys['No']}" width="10%" style="text-align: right;">
                            <h:outputText value="#{sum.description}">
                                <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                            <f:facet name="footer">
                                <h:outputText value="#{subscriptionBean.getTotalNo(subscriptionBean.subscriptionsSummary_recurring)}">
                                    <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                                </h:outputText>
                            </f:facet>
                        </p:column>
                        <p:column>
                            <f:facet name="footer">
                                <h:outputText value="#{subscriptionBean.getTotalAmount(subscriptionBean.subscriptionsSummary_recurring)}">
                                    <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                                </h:outputText>
                            </f:facet>
                        </p:column>
                        <p:column headerText="#{langsys['Average']}" style="text-align: right;">
                            <h:outputText value="#{sum.amount/sum.description}">
                                <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                    <p:dataTable id="tblSummaryAmount" tableStyle="width:100%;" var="sfa" value="#{subscriptionBean.subscriptionsSummary_freq_amount}">
                        <p:column headerText="#{langsys['Frequency']}">
                            <h:outputLabel value="#{sfa.frequency}"/>
                        </p:column>
                        <p:column headerText="#{langsys['Amount']} #{langsys['at']} #{langsys['Registration']}" style="text-align: right;">
                            <h:outputText value="#{sfa.amount_at_reg}">
                                <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="#{langsys['Amount']} #{langsys['at']} #{langsys['Renewal']}" style="text-align: right;">
                            <h:outputText value="#{sfa.amount_at_renewal}">
                                <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </h:panelGrid>
                <p:dataTable id="tblSummarySubscriptionCategory" tableStyle="width:100%;" var="sum" value="#{subscriptionBean.subscriptionsSummary_subscriptionCategory}">
                    <p:column headerText="#{langsys['Subscription']} #{langsys['Category']}">
                        <h:outputLabel value="#{subscriptionCategoryBean.getSubscriptionCategory(sum.subscription_category_id).getCategory_name()}"/>
                        <f:facet name="footer">
                            <h:outputText value="Total" />
                        </f:facet>
                    </p:column>
                    <p:column headerText="#{langsys['No']}" style="text-align: right;" width="10%">
                        <h:outputText value="#{sum.description}">
                            <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{subscriptionBean.getTotalNo(subscriptionBean.subscriptionsSummary_subscriptionCategory)}">
                                <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="#{langsys['Amount']}" style="text-align: right;">
                        <h:outputText value="#{sum.amount}">
                            <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{subscriptionBean.getTotalAmount(subscriptionBean.subscriptionsSummary_subscriptionCategory)}">
                                <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                </p:dataTable>
                <p:dataTable id="tblLocation" tableStyle="width:auto;" var="sum" value="#{subscriptionBean.subscriptionsSummary_location}">
                    <p:column headerText="#{langsys[menuItemBean.menuItemObj.LOC_LEVEL_2_LABEL]}">
                        <f:facet name="footer">
                            <h:outputText value="Total" />
                        </f:facet>
                    </p:column>
                    <p:column headerText="#{langsys['No']}" style="text-align: right;">
                        <h:outputText value="#{sum.description}">
                            <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{subscriptionBean.getTotalNo(subscriptionBean.subscriptionsSummary_location)}">
                                <f:convertNumber pattern="###,###.###" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="#{langsys['Amount']}" style="text-align: right;">
                        <h:outputText value="#{sum.amount}">
                            <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{subscriptionBean.getTotalAmount(subscriptionBean.subscriptionsSummary_location)}">
                                <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                </p:dataTable>
            </h:panelGrid>
            <!--Form was here-->

            <p:dataTable id="dtblSubscription" tableStyle="width:auto;" value="#{subscriptionBean.subscriptions}" var="s"                           
                         paginator="true" rows="50" 
                         paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {Exporters}" 
                         rowsPerPageTemplate="50,100,400,800,1000,2000"
                         rowStyleClass="#{s.current_status eq 'Active' ? 'green' : s.current_status eq 'Opted Out' ? 'red' : 'amber'}">
                <f:facet name="header">
                    #{itemBean.itemsList.size()} #{langsys['Records']} #{langsys['Found']}
                    <p:commandButton id="toggler" type="button" value="Columns" icon="ui-icon-calculator" />
                    <p:columnToggler datasource="dtblSubscription" trigger="toggler" />
                </f:facet>
                <f:facet name="{Exporters}">
                    <h:commandLink>
                        <p:graphicImage name="images/excel.png" width="24"/>
                        <p:dataExporter type="xls" target="dtblSubscription" fileName="Subscription" />
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/pdf.png" width="24"/>
                        <p:dataExporter type="pdf" target="dtblSubscription" fileName="Subscription"/>
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/csv.png" width="24"/>
                        <p:dataExporter type="csv" target="dtblSubscription" fileName="Subscription" />
                    </h:commandLink>
                    <h:commandLink>
                        <p:graphicImage name="images/xml.png" width="24"/>
                        <p:dataExporter type="xml" target="dtblSubscription" fileName="Subscription" />
                    </h:commandLink>
                </f:facet>
                <p:column headerText="#{langsys['Transactor']}">
                    <h:outputText value="#{transactorBean.findTransactor(s.transactor_id).getTransactorNames()}"/>
                </p:column>
                <p:column headerText="#{langsys['Sub']} #{langsys['Category']} #{langsys['Activity']}">
                    <h:outputText value="#{subscriptionCategoryBean.getSubscriptionCategory(s.subscription_category_id).getCategory_name()}"/>
                </p:column>
                <p:column headerText="#{langsys['Activity']} #{langsys['Category']}">
                    <h:outputText value="#{businessCategoryBean.getBusinessCategory(s.business_category_id).getCategory_name()}"/>
                </p:column>
                <p:column headerText="#{langsys['Staff']}">
                    <h:outputText value="#{itemBean.findItem(s.item_id).getDescription()}"/>
                </p:column>
                <p:column headerText="#{langsys['Activity']} #{langsys['Mode']}" visible="false">
                    <h:outputText value="#{s.description}"/>
                </p:column>
                <p:column headerText="#{langsys['Activity']} #{langsys['Name']}" visible="false">
                    <h:outputText value="#{s.description}"/>
                </p:column>
                <p:column headerText="#{langsys['Unit']} #{langsys['Of']} #{langsys['Time']}" style="text-align: right;" visible="false">
                    <h:outputText value="#{s.unit_price}">
                        <f:convertNumber locale="#{utilityBean.convertLocaleToString()}"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="#{langsys['Free']} #{langsys['at']} #{langsys['Registration']}" visible="false">
                    <h:outputText value="#{s.free_at_reg eq 1 ? 'Yes' : 'No'}"/>
                </p:column>
                <p:column headerText="#{langsys['Activity']} #{langsys['Date']}" visible="false">
                    <h:outputText value="#{utilityBean.formatDate(s.subscription_date)}"/>
                </p:column>
                <p:column headerText="#{langsys['Time']} #{langsys['Taken']}" visible="false">
                    <h:outputText value="#{utilityBean.formatDate(s.subscription_date)}"/>
                </p:column>
                <p:column headerText="#{langsys['Submission']} #{langsys['Date']}" visible="false">
                    <h:outputText value="#{utilityBean.formatDate(s.renewal_date)}"/>
                </p:column>
                <p:column headerText="#{langsys['Add']} #{langsys['Date']}" visible="false">
                    <h:outputText value="#{utilityBean.formatDate(s.add_date)}"/>
                </p:column>
                <p:column headerText="#{langsys['Added']} #{langsys['By']}" visible="false">
                    <h:outputText value="#{s.added_by}"/>
                </p:column>
                <p:column headerText="#{langsys['Edit']} #{langsys['Date']}" visible="false">
                    <h:outputText value="#{utilityBean.formatDate(s.last_edit_date)}"/>
                </p:column>
                <p:column headerText="#{langsys['Edited']} #{langsys['By']}" visible="false">
                    <h:outputText value="#{s.last_edited_by}"/>
                </p:column>

                <p:column headerText="#{langsys['Action']}" exportable="false" style="min-width: 125px">
                    <p:commandButton actionListener="#{subscriptionBean.displaySubscription(s,subscription)}" oncomplete="PF('dlgSubscriptionDetail').show();" icon="ui-icon-note" title="View Subscription Detail" style="color: white;" >
                    </p:commandButton>
                    &nbsp;
                    <p:commandButton update="form:modalSubscription" actionListener="#{subscriptionBean.displaySubscription(s,subscription)}" oncomplete="PF('dlgSubscription').show();" icon="ui-icon-pencil" title="Edit Subscription" style="color: white; background-color: #00B259" >
                    </p:commandButton>
                    &nbsp;
                    <p:commandButton update="form:pnlgSummary form:dtblSubscription form:growl1" actionListener="#{subscriptionBean.optOut(s)}" icon="ui-icon-arrowreturnthick-1-n" title="Opt Out" style="color: white; background-color: red !important" >
                    </p:commandButton>
                    &nbsp;
                    <p:commandButton update="form:modalSubscriptionRenewal" actionListener="#{subscriptionBean.displaySubscriptionRenewal(s,subscription)}" oncomplete="PF('dlgSubscriptionRenewal').show();" icon="ui-icon-seek-next" title="Renew" style="color: white; background-color: blueviolet !important" >
                    </p:commandButton>
                    &nbsp;
                    <p:commandButton update="modalSubscriptionLog" actionListener="#{subscriptionBean.getSubscriptionLogBySubscriptionId(s.subscription_id)}" oncomplete="PF('dlgSubscriptionLog').show();" icon="ui-icon-info" title="View Subscription Logs" style="color: white; background-color: yellow !important" >
                    </p:commandButton>
                    &nbsp;
                </p:column>

            </p:dataTable>

            <p:dialog rendered="true" dynamic="true" header="#{langsys['Subscription']} #{langsys['Renewal']}" widgetVar="dlgSubscriptionRenewal" id="modalSubscriptionRenewal" modal="true">
                <h:panelGroup id="popupRenewal">
                    <h:panelGrid columns="4">
                        <h:outputLabel value="#{langsys['Qty']}:"/>
                        <p:inputNumber inputStyle="width: 320px" value="#{subscription.qty}" minValue="1" autocomplete="off">
                            <p:ajax event="blur" listener="#{subscriptionBean.setItemAmount(subscription)}" update="form:itemAmountRenewal"/>
                        </p:inputNumber>
                        <h:outputLabel value="#{langsys['Unit']} #{langsys['Price']}:"/>
                        <p:inputNumber id="unitPriceRenewal" inputStyle="width: 320px" value="#{subscriptionBean.itemUnitPrice}" autocomplete="off">
                            <p:ajax event="blur" listener="#{subscriptionBean.setItemAmount(subscription)}" update="form:itemAmountRenewal"/>
                        </p:inputNumber>
                        <h:outputLabel value="#{langsys['Amount']}:"/>
                        <p:inputText id="itemAmountRenewal" style="width: 320px" value="#{subscription.amount}" readonly="True" disabled="True" autocomplete="off" />
                        <h:outputLabel  value="#{langsys['Acivity']} #{langsys['Date']}:"/>
                        <p:calendar value="#{timesheetBean.filterActivityDate}" pattern="#{companySetting.getDateFormat()}" disabled="True" navigator="true" showButtonPanel="true" readonlyInput="false" autocomplete="off" inputStyle="width: 320px" style="width: 350px">
                        </p:calendar>
                        <h:outputLabel  value="#{langsys['Frequency']}:"/>
                        <p:inputText id="frequencyRenewal" style="width: 320px" value="#{subscription.frequency}" readonly="True" disabled="True" autocomplete="off" />
                        <h:outputLabel  value="#{langsys['Renewal']} #{langsys['Date']}:"/>
                        <p:calendar value="#{subscription.renewal_date}" pattern="#{companySetting.getDateFormat()}" navigator="true" showButtonPanel="true" readonlyInput="false" autocomplete="off" inputStyle="width: 320px" style="width: 350px">
                            <f:ajax event="dateSelect" listener="#{subscriptionBean.setExpiryDateRenewal(subscription)}" render="form:expiryDateRenewal form:currentStatusRenewal"/>
                        </p:calendar>
                    </h:panelGrid>

                    <h:panelGrid styleClass="clsGridMainCommands" columns="1">
                        <h:panelGrid styleClass="clsGridMainCommands1" columns="4">
                            <p:commandButton id="cmdbSaveRenewal" actionListener="#{subscriptionBean.renew(subscription)}" update="pnlgSummary form:popupRenewal form:dtblSubscription form:growl1Renewal" styleClass="clsButtonBig" value="#{langsys['RENEW']}" disabled="#{subscription.current_status eq 'Expired' or subscription.amount lt subscription.commission_amount}" style="color: white; background-color: #00B259" onclick="PF('statusDialogRenewal').show()" onsuccess="PF('statusDialogRenewal').hide()">
                                <p:dialog widgetVar="statusDialogRenewal" height="100" position="center" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                                    <p:graphicImage id="emma" name="/images/ajax-loader.gif"/>
                                </p:dialog>
                            </p:commandButton>
                            <p:commandButton update="form:popupRenewal" actionListener="#{subscriptionBean.clearSubscription(subscription)}" styleClass="clsButtonBig" id="cmdbClearRenewal" value="#{langsys['CLEAR']}" style="color: white; background-color: #FF0000">
                            </p:commandButton>
                        </h:panelGrid>
                    </h:panelGrid>

                    <h:panelGrid styleClass="clsGridMainMessages" columns="1">
                        <h:outputLabel styleClass="clsActionMessage" id="olblActionMessageRenewal" value="#{subscriptionBean.actionMessage}"/>
                        <h:messages id="msgsMainMessageRenewal" style="color: red"/><br/>
                    </h:panelGrid>
                    <p:growl id="growl1Renewal"/>

                </h:panelGroup>
            </p:dialog>

            <p:dialog rendered="true" dynamic="true" header="#{langsys['Time']} #{langsys['Sheet']} #{langsys['Detail']}" widgetVar="dlgSubscription" id="modalSubscription" modal="true" height="425px">
                <h:panelGroup id="popup">
                    <!--<h:outputText value="This is a Modal Dialog." />-->
                    <h:panelGrid columns="4">
                        <h:outputLabel  value="#{langsys['Activity']} #{'status'}:"/>
                        <p:inputText id="activityStatus" style="width: 320px" value="#{timesheet.activity_status}" autocomplete="off" />
                        <h:outputLabel  value="#{langsys['Customer']}:"/>

                        <p:autoComplete id="autcTransactor" value="#{transactor}" 
                                        completeMethod="#{transactorBean.getTransactorActiveObjectList}" 
                                        var="trct" 
                                        itemLabel="#{trct.transactorNames}" 
                                        itemValue="#{trct}" 
                                        converter="TransactorConverter" style="text-align: left;" 
                                        forceSelection="true" queryDelay="0" inputStyle="width: 320px" 
                                        >
                            <p:column headerText="#{langsys['Names']}" style="text-align: left" >  
                                #{trct.transactorNames} 
                            </p:column>
                            <p:column headerText="#{langsys['Type']}" style="text-align: left" >  
                                #{transactorBean.getDisplayName(menuItemBean.menuItemObj,trct)}
                            </p:column> 
                            <p:column headerText="#{langsys['Contact']} #{langsys['Person']}" style="text-align: left">  
                                #{trct.cpName} 
                            </p:column>
                        </p:autoComplete>
                        <h:outputLabel  value="#{langsys['Activity']} #{langsys['Name']}:"/>
                        <p:inputText id="activityname" style="width: 320px" value="#{timesheet.activity_name}" autocomplete="off" />
                        <h:outputLabel  value="#{langsys['Sub']} #{langsys['Category']} #{langsys['Name']} :"/>
                        <p:inputText id="subactivityname" style="width: 320px" value="#{timesheet.activity_name}" autocomplete="off" />
                        <h:outputLabel  value="#{langsys['Activity']} #{langsys['Date']}:"/>
                        <p:calendar value="#{timesheet.activity_date}" pattern="#{companySetting.getDateFormat()}" navigator="true" showButtonPanel="true" readonlyInput="false" autocomplete="off" inputStyle="width: 320px" style="width: 350px">
                        </p:calendar>
                        <h:outputLabel  value="#{langsys['Submission']} #{langsys['Date']}:"/>
                        <p:calendar value="#{timesheet.submission_date}" pattern="#{companySetting.getDateFormat()}" navigator="true" showButtonPanel="true" readonlyInput="false" autocomplete="off" inputStyle="width: 320px" style="width: 350px">
                        </p:calendar>
                        <h:outputLabel  value="#{langsys['Item']}:"/>
                        <p:autoComplete id="autcItem" widgetVar="WautcItem" value="#{subscriptionBean.selectedItem}"  
                                        completeMethod="#{itemBean.getItemObjectListForSale_old}" 
                                        var="itm" 
                                        itemLabel="#{itm.description}" 
                                        itemValue="#{itm}" 
                                        converter="ItemConverter" style="text-align: left" 
                                        forceSelection="true" queryDelay="0" inputStyle="width: 320px"
                                        >

                            <p:column headerText="#{langsys['Item']} #{langsys['Description']}" style="text-align: left" >  
                                #{itm.description} 
                            </p:column>
                            <p:column headerText="#{langsys['Alias']}" style="text-align: left" >  
                                #{itm.alias_name} 
                            </p:column>
                            <p:column headerText="#{langsys['Item']} #{langsys['Code']}" style="text-align: left" >  
                                #{itm.itemCode} 
                            </p:column>
                            <p:column headerText="#{langsys['Unit']}" style="text-align: left">  
                                #{itm.unitSymbol}
                            </p:column> 
                            <p:column headerText="#{langsys['Category']}" style="text-align: left">  
                                #{itm.categoryName}
                            </p:column>
                            <f:attribute name="subs" value="#{subscription}" />
                            <p:ajax event="itemSelect" listener="#{subscriptionBean.setItemPrice}" process="@form" update="form:unitPrice form:itemAmount"/>
                            <p:ajax event="change" listener="#{subscriptionBean.setItemPrice}" process="@form" update="form:unitPrice form:itemAmount" onstart="if(PF('WautcItem').panel.is(':visible')) return false;" />
                        </p:autoComplete>
                        <h:outputLabel  value="#{langsys['Activity']} #{langsys['Category']}:"/>
                        <p:selectOneMenu value="#{timesheet.activity_name}" style="width: 305px">
                            <f:selectItem itemLabel="" itemValue="0"/>
                            <f:selectItems value="#{businessCategoryBean.getBusinessCategory()}" var="bc" itemLabel="#{bc.category_name}" itemValue="#{bc.business_category_id}"/>
                            <p:ajax event="change" update="form:cmdbSave"/>
                        </p:selectOneMenu>
                        <h:outputLabel value="#{langsys['Unit']} #{langsys['Of']}  #{langsys['Time']}:"/>
                        <p:inputNumber id="unitPrice" inputStyle="width: 320px" value="#{subscriptionBean.itemUnitPrice}" autocomplete="off">
                            <p:ajax event="blur" listener="#{subscriptionBean.setItemAmount(subscription)}" update="form:itemAmount"/>
                        </p:inputNumber>
                        <h:outputLabel  value="#{langsys['Sub']} #{langsys['Category']} #{langsys['Activity']}:"/>
                        <p:selectOneMenu value="#{timesheet.subcategory_activity_id}" style="width: 305px">
                            <f:selectItem itemLabel="" itemValue="0"/>
                            <f:selectItems value="#{subscriptionCategoryBean.getSubscriptionCategory()}" var="sc" itemLabel="#{sc.category_name}" itemValue="#{sc.subscription_category_id}"/>
                        </p:selectOneMenu>
                        <h:outputLabel value="#{langsys['Time']} #{langsys['Taken']}:"/>
                        <p:inputText id="itemAmount" style="width: 320px" value="#{subscription.amount}" autocomplete="off" />
                        <h:outputLabel  value="#{langsys['Mode']} #{langsys['Activity']}:"/>
                        <p:selectOneMenu value="#{timesheet.mode_activity_id}" style="width: 305px">
                            <f:selectItem itemLabel="Remote" itemValue="Remote"/>
                        </p:selectOneMenu>

                        <h:outputLabel  value="#{langsys['Project']}:"/>
                        <p:selectOneMenu id="project" value="#{project.project_id}" style="width: 305px">
                            <f:selectItem itemLabel="#{project.project_name}" itemValue="#{project.project_id}"/>
                        </p:selectOneMenu>
                        <h:outputLabel  value="#{langsys['Staff']}:"/>
                        <p:selectOneMenu id="staff" value="#{staff.staff_id}" style="width: 305px">
                            <f:selectItem itemLabel="" itemValue=""/>
                        </p:selectOneMenu>                        
                        <h:outputLabel  value="#{langsys['Free']} #{langsys['at']} #{langsys['Registration']}:"/>
                        <h:selectBooleanCheckbox value="#{subscriptionBean.freeAtReg}" />
                    </h:panelGrid>

                    <h:panelGrid styleClass="clsGridMainCommands" columns="1">
                        <h:panelGrid styleClass="clsGridMainCommands1" columns="4">
                            <p:commandButton update="pnlgFilter pnlgSummary form:popup form:dtblSubscription form:growl1" actionListener="#{subscriptionBean.saveSubscription(subscription)}" styleClass="clsButtonBig" id="cmdbSave" value="#{langsys['SAVE']}" disabled="#{subscription.business_category_id eq 0 or subscription.amount lt subscription.commission_amount}" style="color: white; background-color: #00B259" onclick="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()">
                                <p:dialog widgetVar="statusDialog" height="100" position="center" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                                    <p:graphicImage name="/images/ajax-loader.gif"/>
                                </p:dialog>
                            </p:commandButton>
                            <p:commandButton update="form:popup" actionListener="#{subscriptionBean.clearSubscription(subscription)}" styleClass="clsButtonBig" id="cmdbClear" value="#{langsys['CLEAR']}" style="color: white; background-color: #FF0000">
                            </p:commandButton>
                        </h:panelGrid>
                    </h:panelGrid>

                    <h:panelGrid styleClass="clsGridMainMessages" columns="1">
                        <h:outputLabel styleClass="clsActionMessage" id="olblActionMessage" value="#{subscriptionBean.actionMessage}"/>
                        <h:messages id="msgsMainMessage" style="color: red"/><br/>
                    </h:panelGrid>
                    <p:growl id="growl1"/>
                </h:panelGroup>
            </p:dialog>
            <p:dialog rendered="true" dynamic="true" header="#{langsys['Time']} #{langsys['sheet']} #{langsys['Detail']}" widgetVar="dlgSubscriptionDetail" id="modalSubscriptionDetail" modal="true">
                <h:panelGroup id="popupDetail">
                    <!--<h:outputText value="This is a Modal Dialog." />-->
                    <h:panelGrid columns="2">
                        <h:outputLabel  value="#{langsys['Customer']}:"/>
                        <h:outputLabel  value="#{subscriptionBean.selectedTransactor.transactorNames}"/>
                        <h:outputLabel  value="#{langsys['Item']}:"/>
                        <h:outputText  value="#{subscriptionBean.selectedItem.description}"/>
                        <h:outputLabel  value="#{langsys['Activity']} #{langsys['Category']}:"/>
                        <h:outputText  value="#{businessCategoryBean.getBusinessCategory(subscription.business_category_id).getCategory_name()}"/>
                        <h:outputLabel  value="#{langsys['Sub']} #{langsys['Category']} #{langsys['Activity']}:"/>
                        <h:outputText  value="#{subscriptionCategoryBean.getSubscriptionCategory(subscription.subscription_category_id).getCategory_name()}"/>
                        <h:outputLabel value="#{langsys['Unit']} #{langsys['Of']} #{langsys['Time']}:"/>
                        <h:outputText  value="#{subscriptionBean.itemUnitPrice}">
                            <f:convertNumber pattern="" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                        <h:outputLabel  value="#{langsys['Activity']} #{'status'}:"/>
                        <h:outputText  value="#{subscription.description}"/>
                        <h:outputLabel  value="#{langsys['Activity']} #{'Name'}:"/>
                        <h:outputText  value="#{subscription.description}"/>
                        <h:outputLabel  value="#{langsys['Activity']} #{langsys['Date']}:"/>
                        <h:outputText  value="#{utilityBean.formatDate(subscription.subscription_date)}"/>
                        <h:outputLabel  value="#{langsys['Submission']} #{langsys['Date']}:"/>
                        <h:outputText  value="#{utilityBean.formatDate(subscription.subscription_date)}"/>
                        <h:outputLabel  value="#{langsys['Free']} #{langsys['at']} #{langsys['Registration']}:"/>
                        <h:outputText  value="#{subscriptionBean.freeAtReg eq true ? 'Yes' : 'No'}"/>
                    </h:panelGrid>

                </h:panelGroup>
            </p:dialog>

        </h:form>
        <p:dialog header="Subscription Log" widgetVar="dlgSubscriptionLog" id="modalSubscriptionLog" modal="true">
            <h:panelGroup id="logPopup">

                <h:dataTable id="dtblSubscriptionLog" value="#{subscriptionBean.subscriptionsLogList}" var="sl" styleClass="cls-table" 
                             headerClass="cls-table-header" 
                             rowClasses="cls-table-odd-row,cls-table-even-row" 
                             columnClasses="cls-table-col1,cls-table-col2,cls-table-col3,cls-table-col4,cls-table-col5,cls-table-col6"                         
                             > 
                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">#{langsys['Add']} #{langsys['Date']}</f:facet>
                        <!-- row record -->
                        #{utilityBean.formatDate(sl.add_date)}
                    </p:column>

                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">#{langsys['Added']} #{langsys['By']}</f:facet>
                        <!-- row record -->
                        #{sl.added_by}
                    </p:column>

                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">#{langsys['Action']}</f:facet>
                        <!-- row record -->
                        #{sl.action}
                    </p:column>

                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">#{langsys['Registration']} #{langsys['Date']}</f:facet>
                        <!-- row record -->
                        #{utilityBean.formatDate(sl.subscription_date)}
                    </p:column>

                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">#{langsys['Amount']}</f:facet>
                        <!-- row record -->
                        <h:outputText value="#{sl.amount}">
                            <f:convertNumber pattern="###,###.#" locale="#{utilityBean.convertLocaleToString()}"/>
                        </h:outputText>
                    </p:column>

                    <p:column>
                        <!-- column header -->
                        <f:facet name="header">#{langsys['Status']}</f:facet>
                        <!-- row record -->
                        #{sl.current_status}
                    </p:column>

                </h:dataTable>

            </h:panelGroup>
        </p:dialog>
    </h:body>
</html>

